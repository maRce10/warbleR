<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="warbleR">
<title>Annotation data format • warbleR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Annotation data format">
<meta property="og:description" content="warbleR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">warbleR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.30</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/warbleR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>vignettes</h6>
    <a class="dropdown-item" href="../articles/annotation_data_format.html">Annotation data format</a>
    <a class="dropdown-item" href="../articles/warbleR_workflow_01.html">Import sound files and select signals</a>
    <a class="dropdown-item" href="../articles/warbleR_workflow_02.html">Visual inspection and signal classification</a>
    <a class="dropdown-item" href="../articles/warbleR_workflow_03.html">Acoustic (dis)similarity, coordinated singing and simulating songs</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/maRce10/warbleR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="annotation_data_format_files/kePrint-0.0.1/kePrint.js"></script><link href="annotation_data_format_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Annotation data format</h1>
                        <h4 data-toc-skip class="author"><a href="https://marce10.github.io" class="external-link">Marcelo
Araya-Salas, PhD</a></h4>
            
            <h4 data-toc-skip class="date">2024-03-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/maRce10/warbleR/blob/HEAD/vignettes/annotation_data_format.Rmd" class="external-link"><code>vignettes/annotation_data_format.Rmd</code></a></small>
      <div class="d-none name"><code>annotation_data_format.Rmd</code></div>
    </div>

    
    
<!-- skyblue box -->
<div class="alert alert-info">
<p>This vignette explains in detail the structure of the
<strong>R</strong> data objects containing sound file annotations that
are required by the package <strong>warbleR</strong>.</p>
</div>
<p><img src="warbleR_sticker.png" alt="warbleR logo" align="right" width="25%" height="25%"></p>
<p>An annotation table (or selection table in Raven’s and warbleR’s
terminology) is a data set that contains information about the location
in time (and sometimes in frequency) of the sounds of interest in one or
more sound files. <strong>warbleR</strong> can take sound file
annotations represented in the following <strong>R</strong> objects:</p>
<ul>
<li>Data frames</li>
<li>Selection tables</li>
<li>Extended selection tables</li>
</ul>
<p>The last 2 are annotation specific R classes included in
<strong>warbleR</strong>. Here we described the basic structure of these
objects and how they can be created.</p>
<div class="section level2">
<h2 id="data-frames">Data frames<a class="anchor" aria-label="anchor" href="#data-frames"></a>
</h2>
<p>Data frames with sound file annotations must contain the following
columns:</p>
<ol style="list-style-type: decimal">
<li>
<strong>sound.files</strong>: character or factor column with the
name of the sound files including the file extension
(e.g. “rec_1.wav”)</li>
<li>
<strong>selec</strong>: numeric, character or factor column with a
unique identifier (at least within each sound file) for each annotation
(e.g. 1, 2, 3 or “a”, “b”, “c”)</li>
<li>
<strong>start</strong>: numeric column with the start position in
time of an annotated sound (in seconds)</li>
<li>
<strong>end</strong>: numeric column with the end position in time
of an annotated sound (in seconds)</li>
</ol>
<table class="table table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:center;">
sound.files
</th>
<th style="text-align:center;">
selec
</th>
<th style="text-align:center;">
start
</th>
<th style="text-align:center;">
end
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
sound_file_1.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
3.02
</td>
<td style="text-align:center;">
5.58
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_1.wav
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
7.92
</td>
<td style="text-align:center;">
9.00
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_2.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
4.21
</td>
<td style="text-align:center;">
5.34
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_2.wav
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
8.85
</td>
<td style="text-align:center;">
11.57
</td>
</tr>
</tbody>
</table>
<p>Data frames containing annotations can also include the following
optional columns:</p>
<ul>
<li><ol style="list-style-type: decimal">
<li>
<strong>bottom.freq</strong>: numeric column with the bottom
frequency of the frequency range of the annotation (in kHz)</li>
</ol></li>
<li><ol style="list-style-type: decimal">
<li>
<strong>top.freq</strong>: numeric column with the top frequency of
the frequency range of the annotation (in kHz)</li>
</ol></li>
<li><ol style="list-style-type: decimal">
<li>
<strong>channel</strong>: numeric column with the number of the
channel in which the annotation is found in a multi-channel sound file
(optional, by default is 1 if not supplied)</li>
</ol></li>
</ul>
<table class="table table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:center;">
sound.files
</th>
<th style="text-align:center;">
selec
</th>
<th style="text-align:center;">
start
</th>
<th style="text-align:center;">
end
</th>
<th style="text-align:center;">
bottom.freq
</th>
<th style="text-align:center;">
top.freq
</th>
<th style="text-align:center;">
channel
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
sound_file_1.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
3.02
</td>
<td style="text-align:center;">
5.58
</td>
<td style="text-align:center;">
5.46
</td>
<td style="text-align:center;">
10.22
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_1.wav
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
7.92
</td>
<td style="text-align:center;">
9.00
</td>
<td style="text-align:center;">
3.73
</td>
<td style="text-align:center;">
9.36
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_2.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
4.21
</td>
<td style="text-align:center;">
5.34
</td>
<td style="text-align:center;">
4.31
</td>
<td style="text-align:center;">
9.40
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_2.wav
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
8.85
</td>
<td style="text-align:center;">
11.57
</td>
<td style="text-align:center;">
4.55
</td>
<td style="text-align:center;">
9.11
</td>
<td style="text-align:center;">
1
</td>
</tr>
</tbody>
</table>
<p>The sample data “lbh_selec_table” contains a data frame with
annotations with the format expected by <strong>warbleR</strong>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marce10.github.io/warbleR/">warbleR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lbh_selec_table"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">lbh_selec_table</span><span class="op">)</span></span></code></pre></div>
<table class="table table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:center;">
sound.files
</th>
<th style="text-align:center;">
channel
</th>
<th style="text-align:center;">
selec
</th>
<th style="text-align:center;">
start
</th>
<th style="text-align:center;">
end
</th>
<th style="text-align:center;">
bottom.freq
</th>
<th style="text-align:center;">
top.freq
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
Phae.long1.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1.169
</td>
<td style="text-align:center;">
1.342
</td>
<td style="text-align:center;">
2.22
</td>
<td style="text-align:center;">
8.60
</td>
</tr>
<tr>
<td style="text-align:center;">
Phae.long1.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2.158
</td>
<td style="text-align:center;">
2.321
</td>
<td style="text-align:center;">
2.17
</td>
<td style="text-align:center;">
8.81
</td>
</tr>
<tr>
<td style="text-align:center;">
Phae.long1.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0.343
</td>
<td style="text-align:center;">
0.518
</td>
<td style="text-align:center;">
2.22
</td>
<td style="text-align:center;">
8.76
</td>
</tr>
<tr>
<td style="text-align:center;">
Phae.long2.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.160
</td>
<td style="text-align:center;">
0.292
</td>
<td style="text-align:center;">
2.32
</td>
<td style="text-align:center;">
8.82
</td>
</tr>
<tr>
<td style="text-align:center;">
Phae.long2.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1.457
</td>
<td style="text-align:center;">
1.583
</td>
<td style="text-align:center;">
2.28
</td>
<td style="text-align:center;">
8.89
</td>
</tr>
<tr>
<td style="text-align:center;">
Phae.long3.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.627
</td>
<td style="text-align:center;">
0.758
</td>
<td style="text-align:center;">
3.01
</td>
<td style="text-align:center;">
8.82
</td>
</tr>
<tr>
<td style="text-align:center;">
Phae.long3.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1.974
</td>
<td style="text-align:center;">
2.104
</td>
<td style="text-align:center;">
2.78
</td>
<td style="text-align:center;">
8.89
</td>
</tr>
<tr>
<td style="text-align:center;">
Phae.long3.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0.123
</td>
<td style="text-align:center;">
0.255
</td>
<td style="text-align:center;">
2.32
</td>
<td style="text-align:center;">
9.31
</td>
</tr>
<tr>
<td style="text-align:center;">
Phae.long4.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1.517
</td>
<td style="text-align:center;">
1.662
</td>
<td style="text-align:center;">
2.51
</td>
<td style="text-align:center;">
9.22
</td>
</tr>
<tr>
<td style="text-align:center;">
Phae.long4.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2.933
</td>
<td style="text-align:center;">
3.077
</td>
<td style="text-align:center;">
2.58
</td>
<td style="text-align:center;">
10.23
</td>
</tr>
<tr>
<td style="text-align:center;">
Phae.long4.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0.145
</td>
<td style="text-align:center;">
0.290
</td>
<td style="text-align:center;">
2.58
</td>
<td style="text-align:center;">
9.74
</td>
</tr>
</tbody>
</table>
<p>Typically, annotations are created in other sound analysis programs
(mainly, Raven, Avisoft, Syrinx and Audacity) and then imported into
<em>R</em>. We recommend annotating sound files in <a href="http://www.birds.cornell.edu/brp/raven/RavenOverview.html" class="external-link">Raven
sound analysis software</a> (<a href="http://www.birds.cornell.edu" class="external-link">Cornell Lab of Ornithology</a>) and
then importing them into <strong>R</strong> with the package <a href="https://marce10.github.io/Rraven/" class="external-link"><strong>Rraven</strong></a>.
This package facilitates data exchange between R and <a href="http://www.birds.cornell.edu/brp/raven/RavenOverview.html" class="external-link">Raven
sound analysis software</a> and allow users to import annotation data
into R using the <strong>warbleR</strong> annotation format (see
argument ‘warbler.format’ in the function <code>imp_raven()</code>).</p>
<!-- light brown box -->
<div class="alert alert-warning">
<p>Data frames containing annotations always refer to sound files.
Therefore, when using data frames users <em>must always indicate the
location of the sound files</em> to every <strong>warbleR</strong>
function when providing annotations in this format.</p>
</div>
</div>
<div class="section level2">
<h2 id="warbler-annotation-formats">warbleR annotation formats<a class="anchor" aria-label="anchor" href="#warbler-annotation-formats"></a>
</h2>
<div class="section level3">
<h3 id="selection-tables">Selection tables<a class="anchor" aria-label="anchor" href="#selection-tables"></a>
</h3>
<p>These objects are created with the <code><a href="../reference/selection_table.html">selection_table()</a></code>
function. The function takes data frames containing annotation data as
in the format described above. Therefore the same mandatory and optional
columns are used by selection tables. The function verifies if the
information is consistent (see the function <code><a href="../reference/check_sels.html">check_sels()</a></code>
for details) and saves the ‘diagnostic’ metadata as an attribute in the
output object. Selection tables are basically data frames in which the
information contained has been double checked to ensure it can be read
by other <strong>warbleR</strong> functions.</p>
<p>Selection tables are created by the function
<code><a href="../reference/selection_table.html">selection_table()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># write example sound files in temporary directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tuneR/man/writeWave.html" class="external-link">writeWave</a></span><span class="op">(</span><span class="va">Phae.long1</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Phae.long1.wav"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tuneR/man/writeWave.html" class="external-link">writeWave</a></span><span class="op">(</span><span class="va">Phae.long2</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Phae.long2.wav"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tuneR/man/writeWave.html" class="external-link">writeWave</a></span><span class="op">(</span><span class="va">Phae.long3</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Phae.long3.wav"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tuneR/man/writeWave.html" class="external-link">writeWave</a></span><span class="op">(</span><span class="va">Phae.long4</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"Phae.long4.wav"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">st</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/selection_table.html">selection_table</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">lbh_selec_table</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">st</span><span class="op">)</span></span></code></pre></div>
<table class="table table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
sound.files
</th>
<th style="text-align:right;">
channel
</th>
<th style="text-align:right;">
selec
</th>
<th style="text-align:right;">
start
</th>
<th style="text-align:right;">
end
</th>
<th style="text-align:right;">
bottom.freq
</th>
<th style="text-align:right;">
top.freq
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Phae.long1.wav
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.169
</td>
<td style="text-align:right;">
1.342
</td>
<td style="text-align:right;">
2.22
</td>
<td style="text-align:right;">
8.60
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long1.wav
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.158
</td>
<td style="text-align:right;">
2.321
</td>
<td style="text-align:right;">
2.17
</td>
<td style="text-align:right;">
8.81
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long1.wav
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.343
</td>
<td style="text-align:right;">
0.518
</td>
<td style="text-align:right;">
2.22
</td>
<td style="text-align:right;">
8.76
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long2.wav
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.160
</td>
<td style="text-align:right;">
0.292
</td>
<td style="text-align:right;">
2.32
</td>
<td style="text-align:right;">
8.82
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long2.wav
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.457
</td>
<td style="text-align:right;">
1.583
</td>
<td style="text-align:right;">
2.28
</td>
<td style="text-align:right;">
8.89
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long3.wav
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.627
</td>
<td style="text-align:right;">
0.758
</td>
<td style="text-align:right;">
3.01
</td>
<td style="text-align:right;">
8.82
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long3.wav
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.974
</td>
<td style="text-align:right;">
2.104
</td>
<td style="text-align:right;">
2.78
</td>
<td style="text-align:right;">
8.89
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long3.wav
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.123
</td>
<td style="text-align:right;">
0.255
</td>
<td style="text-align:right;">
2.32
</td>
<td style="text-align:right;">
9.31
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long4.wav
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.517
</td>
<td style="text-align:right;">
1.662
</td>
<td style="text-align:right;">
2.51
</td>
<td style="text-align:right;">
9.22
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long4.wav
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.933
</td>
<td style="text-align:right;">
3.077
</td>
<td style="text-align:right;">
2.58
</td>
<td style="text-align:right;">
10.23
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long4.wav
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.145
</td>
<td style="text-align:right;">
0.290
</td>
<td style="text-align:right;">
2.58
</td>
<td style="text-align:right;">
9.74
</td>
</tr>
</tbody>
</table>
<p>Selection table is an especific object class:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">st</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] "selection_table" "data.frame"     </code></pre>
<p>They have their own printing method:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st</span></span></code></pre></div>
<pre><code>Object of class 'selection_table'
* The output of the following call:
selection_table(X = lbh_selec_table, path = tempdir(), pb = FALSE)

Contains: *  A selection table data frame with 11 rows and 7 columns:
|sound.files    | channel| selec| start|   end| bottom.freq|
|:--------------|-------:|-----:|-----:|-----:|-----------:|
|Phae.long1.wav |       1|     1| 1.169| 1.342|        2.22|
|Phae.long1.wav |       1|     2| 2.158| 2.321|        2.17|
|Phae.long1.wav |       1|     3| 0.343| 0.518|        2.22|
|Phae.long2.wav |       1|     1| 0.160| 0.292|        2.32|
|Phae.long2.wav |       1|     2| 1.457| 1.583|        2.28|
|Phae.long3.wav |       1|     1| 0.627| 0.758|        3.01|
... 1 more column(s) (top.freq)
 and 5 more row(s)

* A data frame (check.results) with 11 rows generated by check_sels() (as attribute)
created by warbleR 1.1.30</code></pre>
<p>Note that the path to the sound files must be provided. This is
necessary in order to verify that the data provided conforms to the
characteristics of the audio files.</p>
<!-- light brown box -->
<div class="alert alert-warning">
<p>Selection table also refer to sound files. Therefore, users
<strong>must always indicate the location of the sound files to every
<em>warbleR</em> function</strong> when providing annotations in this
format</p>
</div>
</div>
<div class="section level3">
<h3 id="extended-selection-tables">Extended selection tables<a class="anchor" aria-label="anchor" href="#extended-selection-tables"></a>
</h3>
<p>Extended selection tables are annotations that include both the
acoustic and annotation data. This an specific object class,
<em>extended_selection_table</em>, that include a list of ‘wave’ objects
corresponding to each of the selections in the data. Therefore, the
function <strong>transforms the selection table into self-contained
objects</strong> since the original sound files are no longer needed to
perform most of the acoustic analysis in <strong>warbleR</strong>. This
can facilitate the storage and exchange of (bio)acoustic data. This
format can also speed up analyses, since it is not necessary to read the
sound files every time the data is analyzed.</p>
<p>The <code><a href="../reference/selection_table.html">selection_table()</a></code> function also creates extended
selection tables. To do this, users must set the argument
<code>extended = TRUE</code> (otherwise, the class would be a selection
table). The following code converts the example ‘lbh_selec_table’ data
into an extended selection table:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/selection_table.html">selection_table</a></span><span class="op">(</span></span>
<span>  X <span class="op">=</span> <span class="va">lbh_selec_table</span>,</span>
<span>  pb <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  extended <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Extended selection table is an specific object class:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] "extended_selection_table" "data.frame"              </code></pre>
<p>The class has its own printing method:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est</span></span></code></pre></div>
<pre><code>Object of class 'extended_selection_table'
* The output of the following call:
selection_table(X = lbh_selec_table, path = tempdir(), extended = TRUE,  pb = FALSE)

Contains: 
*  A selection table data frame with 11 row(s) and 7 columns:
|sound.files      | channel| selec| start|   end| bottom.freq|
|:----------------|-------:|-----:|-----:|-----:|-----------:|
|Phae.long1.wav_1 |       1|     1|   0.1| 0.273|        2.22|
|Phae.long1.wav_2 |       1|     1|   0.1| 0.263|        2.17|
|Phae.long1.wav_3 |       1|     1|   0.1| 0.275|        2.22|
|Phae.long2.wav_1 |       1|     1|   0.1| 0.233|        2.32|
|Phae.long2.wav_2 |       1|     1|   0.1| 0.226|        2.28|
|Phae.long3.wav_1 |       1|     1|   0.1| 0.231|        3.01|
... 1 more column(s) (top.freq)
 and 5 more row(s)

* 11 wave object(s) (as attributes): 
Phae.long1.wav_1, Phae.long1.wav_2, Phae.long1.wav_3, Phae.long2.wav_1, Phae.long2.wav_2, Phae.long3.wav_1
... and 5 more

* A data frame (check.results) with 11 rows generated by check_sels() (as attribute)

The selection table was created by element (see 'class_extended_selection_table')
* 1 sampling rate(s) (in kHz): 22.5
* 1 bit depth(s): 16
* Created by warbleR 1.1.30</code></pre>
<div class="section level4">
<h4 id="handling-extended-selection-tables">Handling extended selection tables<a class="anchor" aria-label="anchor" href="#handling-extended-selection-tables"></a>
</h4>
<p>Several functions can be used to deal with objects of this class.
First can test if the object belongs to the
<em>extended_selection_table</em>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/is_extended_selection_table.html">is_extended_selection_table</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<p>You can subset the selection in the same way that any other data
frame and it will still keep its attributes:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est2</span> <span class="op">&lt;-</span> <span class="va">est</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="../reference/is_extended_selection_table.html">is_extended_selection_table</a></span><span class="op">(</span><span class="va">est2</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<p>As shown above, there is also a generic version of
<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> for this class of objects:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## print</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></code></pre></div>
<pre><code>Object of class 'extended_selection_table'
* The output of the following call:
selection_table(X = lbh_selec_table, path = tempdir(), extended = TRUE,  pb = FALSE)

Contains: 
*  A selection table data frame with 11 row(s) and 7 columns:
|sound.files      | channel| selec| start|   end| bottom.freq|
|:----------------|-------:|-----:|-----:|-----:|-----------:|
|Phae.long1.wav_1 |       1|     1|   0.1| 0.273|        2.22|
|Phae.long1.wav_2 |       1|     1|   0.1| 0.263|        2.17|
|Phae.long1.wav_3 |       1|     1|   0.1| 0.275|        2.22|
|Phae.long2.wav_1 |       1|     1|   0.1| 0.233|        2.32|
|Phae.long2.wav_2 |       1|     1|   0.1| 0.226|        2.28|
|Phae.long3.wav_1 |       1|     1|   0.1| 0.231|        3.01|
... 1 more column(s) (top.freq)
 and 5 more row(s)

* 11 wave object(s) (as attributes): 
Phae.long1.wav_1, Phae.long1.wav_2, Phae.long1.wav_3, Phae.long2.wav_1, Phae.long2.wav_2, Phae.long3.wav_1
... and 5 more

* A data frame (check.results) with 11 rows generated by check_sels() (as attribute)

The selection table was created by element (see 'class_extended_selection_table')
* 1 sampling rate(s) (in kHz): 22.5
* 1 bit depth(s): 16
* Created by warbleR 1.1.30</code></pre>
<p>… which is equivalent to:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est</span></span></code></pre></div>
<pre><code>Object of class 'extended_selection_table'
* The output of the following call:
selection_table(X = lbh_selec_table, path = tempdir(), extended = TRUE,  pb = FALSE)

Contains: 
*  A selection table data frame with 11 row(s) and 7 columns:
|sound.files      | channel| selec| start|   end| bottom.freq|
|:----------------|-------:|-----:|-----:|-----:|-----------:|
|Phae.long1.wav_1 |       1|     1|   0.1| 0.273|        2.22|
|Phae.long1.wav_2 |       1|     1|   0.1| 0.263|        2.17|
|Phae.long1.wav_3 |       1|     1|   0.1| 0.275|        2.22|
|Phae.long2.wav_1 |       1|     1|   0.1| 0.233|        2.32|
|Phae.long2.wav_2 |       1|     1|   0.1| 0.226|        2.28|
|Phae.long3.wav_1 |       1|     1|   0.1| 0.231|        3.01|
... 1 more column(s) (top.freq)
 and 5 more row(s)

* 11 wave object(s) (as attributes): 
Phae.long1.wav_1, Phae.long1.wav_2, Phae.long1.wav_3, Phae.long2.wav_1, Phae.long2.wav_2, Phae.long3.wav_1
... and 5 more

* A data frame (check.results) with 11 rows generated by check_sels() (as attribute)

The selection table was created by element (see 'class_extended_selection_table')
* 1 sampling rate(s) (in kHz): 22.5
* 1 bit depth(s): 16
* Created by warbleR 1.1.30</code></pre>
<p>You can also split them and/or combine them by rows. Here the
original <em>extended_selection_table</em> is divided into 2 and bound
again using <code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind()</a></code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est3</span> <span class="op">&lt;-</span> <span class="va">est</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">est4</span> <span class="op">&lt;-</span> <span class="va">est</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fl">11</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">est5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">est3</span>, <span class="va">est4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print</span></span>
<span><span class="va">est5</span></span></code></pre></div>
<pre><code>Object of class 'extended_selection_table'
* The output of the following call:
rbind(deparse.level, ..1, ..2)

Contains: 
*  A selection table data frame with 11 row(s) and 7 columns:
|sound.files      | channel| selec| start|   end| bottom.freq|
|:----------------|-------:|-----:|-----:|-----:|-----------:|
|Phae.long1.wav_1 |       1|     1|   0.1| 0.273|        2.22|
|Phae.long1.wav_2 |       1|     1|   0.1| 0.263|        2.17|
|Phae.long1.wav_3 |       1|     1|   0.1| 0.275|        2.22|
|Phae.long2.wav_1 |       1|     1|   0.1| 0.233|        2.32|
|Phae.long2.wav_2 |       1|     1|   0.1| 0.226|        2.28|
|Phae.long3.wav_1 |       1|     1|   0.1| 0.231|        3.01|
... 1 more column(s) (top.freq)
 and 5 more row(s)

* 11 wave object(s) (as attributes): 
Phae.long1.wav_1, Phae.long1.wav_2, Phae.long1.wav_3, Phae.long2.wav_1, Phae.long2.wav_2, Phae.long3.wav_1
... and 5 more

* A data frame (check.results) with 11 rows generated by check_sels() (as attribute)

The selection table was created by element (see 'class_extended_selection_table')
* 1 sampling rate(s) (in kHz): 22.5
* 1 bit depth(s): 16
* Created by warbleR 1.1.30</code></pre>
<p>The resulting extended selection table contains the same data as the
original extended selection table:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># same annotations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">est</span>, <span class="va">est5</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># same acoustic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">est</span>, <span class="st">"wave.objects"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">est5</span>, <span class="st">"wave.objects"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<p>The ‘wave’ objects can be read individually using
<code><a href="../reference/read_sound_file.html">read_sound_file()</a></code>, a wrapper for the
<code><a href="https://rdrr.io/pkg/tuneR/man/readWave.html" class="external-link">readWave()</a></code> function from <strong>tuneR</strong>, which can
handle extended selection tables:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wv1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_sound_file.html">read_sound_file</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">est</span>, index <span class="op">=</span> <span class="fl">3</span>, from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">0.37</span><span class="op">)</span></span></code></pre></div>
<p>These are regular ‘wave’ objects:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">wv1</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] "Wave"
attr(,"package")
[1] "tuneR"</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wv1</span></span></code></pre></div>
<pre><code>
Wave Object
    Number of Samples:      8325
    Duration (seconds):     0.37
    Samplingrate (Hertz):   22500
    Channels (Mono/Stereo): Mono
    PCM (integer format):   TRUE
    Bit (8/16/24/32/64):    16 </code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print spectrogram</span></span>
<span><span class="fu">seewave</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/seewave/man/spectro.html" class="external-link">spectro</a></span><span class="op">(</span></span>
<span>  <span class="va">wv1</span>,</span>
<span>  wl <span class="op">=</span> <span class="fl">150</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ovlp <span class="op">=</span> <span class="fl">90</span>,</span>
<span>  palette <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="va"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span>,</span>
<span>  collevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">0</span> , <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="annotation_data_format_files/figure-html/annotations_8.22-1.png" width="750"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">wv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_sound_file.html">read_sound_file</a></span><span class="op">(</span></span>
<span>    X <span class="op">=</span> <span class="va">est</span>,</span>
<span>    index <span class="op">=</span> <span class="va">i</span>,</span>
<span>    from <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    to <span class="op">=</span> <span class="fl">0.32</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">seewave</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/seewave/man/spectro.html" class="external-link">spectro</a></span><span class="op">(</span></span>
<span>    <span class="va">wv</span>,</span>
<span>    wl <span class="op">=</span> <span class="fl">150</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    scale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    axisX <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    axisY <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    ovlp <span class="op">=</span> <span class="fl">90</span>,</span>
<span>    palette <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="va"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span>,</span>
<span>    collevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">0</span> , <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="annotation_data_format_files/figure-html/annotations_8.23-1.png" width="750"></p>
<p>The <code><a href="../reference/read_sound_file.html">read_sound_file()</a></code> function requires a selection
table, as well as the row index (i.e. the row number) to be able to read
the ‘wave’ objects. It can also read a regular ‘wave’ file if the path
is provided.</p>
<p>Note that other functions that modify data frames are likely to
delete the attributes in which the ‘wave’ objects and metadata are
stored. For example, the merge and the extended selection box will
remove its attributes:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create new data frame</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    sound.files <span class="op">=</span> <span class="va">est</span><span class="op">$</span><span class="va">sound.files</span>,</span>
<span>    site <span class="op">=</span> <span class="st">"La Selva"</span>,</span>
<span>    lek <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"SUR"</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"CCL"</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># combine</span></span>
<span><span class="va">mrg_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">est</span>, <span class="va">Y</span>, by <span class="op">=</span> <span class="st">"sound.files"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check class</span></span>
<span><span class="fu"><a href="../reference/is_extended_selection_table.html">is_extended_selection_table</a></span><span class="op">(</span><span class="va">mrg_est</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] FALSE</code></pre>
<p>In this case, we can use the
<code><a href="../reference/fix_extended_selection_table.html">fix_extended_selection_table()</a></code> function to transfer the
attributes of the original extended selection table:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fix est</span></span>
<span><span class="va">mrg_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fix_extended_selection_table.html">fix_extended_selection_table</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">mrg_est</span>, Y <span class="op">=</span> <span class="va">est</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check class</span></span>
<span><span class="fu"><a href="../reference/is_extended_selection_table.html">is_extended_selection_table</a></span><span class="op">(</span><span class="va">mrg_est</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<p>This works as long as some of the original sound files are retained
and no other selections are added.</p>
<p>Finally, these objects can be used as input for most
<strong>warbleR</strong> functions, without the need of refering to any
sound file. For instance we can easily measure acoustic parameters on
data in <em>extended_selection_table</em> format using the function
<code><a href="../reference/spectro_analysis.html">spectro_analysis()</a></code>:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#  parametros espectrales</span></span>
<span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spectro_analysis.html">spectro_analysis</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check first 10 columns</span></span>
<span><span class="va">sp</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<table class="table table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
sound.files
</th>
<th style="text-align:right;">
selec
</th>
<th style="text-align:right;">
duration
</th>
<th style="text-align:right;">
meanfreq
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
freq.median
</th>
<th style="text-align:right;">
freq.Q25
</th>
<th style="text-align:right;">
freq.Q75
</th>
<th style="text-align:right;">
freq.IQR
</th>
<th style="text-align:right;">
time.median
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Phae.long1.wav_1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.173
</td>
<td style="text-align:right;">
5.98
</td>
<td style="text-align:right;">
1.40
</td>
<td style="text-align:right;">
6.33
</td>
<td style="text-align:right;">
5.30
</td>
<td style="text-align:right;">
6.87
</td>
<td style="text-align:right;">
1.57
</td>
<td style="text-align:right;">
0.080
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long1.wav_2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.163
</td>
<td style="text-align:right;">
6.00
</td>
<td style="text-align:right;">
1.42
</td>
<td style="text-align:right;">
6.21
</td>
<td style="text-align:right;">
5.33
</td>
<td style="text-align:right;">
6.88
</td>
<td style="text-align:right;">
1.55
</td>
<td style="text-align:right;">
0.082
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long1.wav_3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.175
</td>
<td style="text-align:right;">
6.02
</td>
<td style="text-align:right;">
1.51
</td>
<td style="text-align:right;">
6.42
</td>
<td style="text-align:right;">
5.15
</td>
<td style="text-align:right;">
6.98
</td>
<td style="text-align:right;">
1.83
</td>
<td style="text-align:right;">
0.094
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long2.wav_1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.133
</td>
<td style="text-align:right;">
6.40
</td>
<td style="text-align:right;">
1.34
</td>
<td style="text-align:right;">
6.60
</td>
<td style="text-align:right;">
5.61
</td>
<td style="text-align:right;">
7.38
</td>
<td style="text-align:right;">
1.77
</td>
<td style="text-align:right;">
0.074
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long2.wav_2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.126
</td>
<td style="text-align:right;">
6.31
</td>
<td style="text-align:right;">
1.37
</td>
<td style="text-align:right;">
6.60
</td>
<td style="text-align:right;">
5.61
</td>
<td style="text-align:right;">
7.21
</td>
<td style="text-align:right;">
1.60
</td>
<td style="text-align:right;">
0.084
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long3.wav_1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.131
</td>
<td style="text-align:right;">
6.61
</td>
<td style="text-align:right;">
1.09
</td>
<td style="text-align:right;">
6.67
</td>
<td style="text-align:right;">
6.06
</td>
<td style="text-align:right;">
7.34
</td>
<td style="text-align:right;">
1.27
</td>
<td style="text-align:right;">
0.058
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long3.wav_2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.130
</td>
<td style="text-align:right;">
6.64
</td>
<td style="text-align:right;">
1.12
</td>
<td style="text-align:right;">
6.67
</td>
<td style="text-align:right;">
6.11
</td>
<td style="text-align:right;">
7.43
</td>
<td style="text-align:right;">
1.32
</td>
<td style="text-align:right;">
0.072
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long3.wav_3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.131
</td>
<td style="text-align:right;">
6.58
</td>
<td style="text-align:right;">
1.25
</td>
<td style="text-align:right;">
6.65
</td>
<td style="text-align:right;">
6.03
</td>
<td style="text-align:right;">
7.39
</td>
<td style="text-align:right;">
1.36
</td>
<td style="text-align:right;">
0.058
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long4.wav_1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.145
</td>
<td style="text-align:right;">
6.22
</td>
<td style="text-align:right;">
1.48
</td>
<td style="text-align:right;">
6.23
</td>
<td style="text-align:right;">
5.46
</td>
<td style="text-align:right;">
7.30
</td>
<td style="text-align:right;">
1.85
</td>
<td style="text-align:right;">
0.087
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long4.wav_2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.144
</td>
<td style="text-align:right;">
6.46
</td>
<td style="text-align:right;">
1.59
</td>
<td style="text-align:right;">
6.34
</td>
<td style="text-align:right;">
5.63
</td>
<td style="text-align:right;">
7.57
</td>
<td style="text-align:right;">
1.94
</td>
<td style="text-align:right;">
0.087
</td>
</tr>
<tr>
<td style="text-align:left;">
Phae.long4.wav_3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.145
</td>
<td style="text-align:right;">
6.12
</td>
<td style="text-align:right;">
1.54
</td>
<td style="text-align:right;">
6.08
</td>
<td style="text-align:right;">
5.18
</td>
<td style="text-align:right;">
7.24
</td>
<td style="text-align:right;">
2.06
</td>
<td style="text-align:right;">
0.087
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="by-element-vs-by-song-extended-selection-tables">‘By element’ vs ‘by song’ extended selection tables<a class="anchor" aria-label="anchor" href="#by-element-vs-by-song-extended-selection-tables"></a>
</h4>
<p>As mention above extended selection tables by default contain one
wave object for each annotation (i.e. row):</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">est</span>, <span class="st">"wave.objects"</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">sound.files</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<p>This default behavior generates a ‘by element’ extended selection
table, as each resulting wave object contains a single element (usually
defined as continuous traces of power spectral entropy in the
spectrograms). Acoustic signals can have structure above this basic
signal units (elements), like in long repertoire songs or multi-syllable
calls, in which elements are always broadcast as a sequences, often with
consistent order and timing. It is then desirable to keep information
about the relative position of elements in these sequences. However,‘by
element’ extended selection tables discards some element sequence
information. This can be overwritten using the argument
<code>by.song</code>, which allows to keep in a single wave object all
the elements belonging to the same ‘song’. In this case song refers to
any grouping of sounds above the ‘element’ level.</p>
<p>The song of the Scale-throated Hermit (<em>Phaethornis eurynome</em>)
will be used to show how this can be done. This song consists of a
sequence of two elements, which are separated by short gaps:</p>
<div class="figure" style="text-align: right">
<img src="Phaethornis-eurynome-15607-labeled.jpeg" alt="Annotated spectrogram of Scale-throated Hermit songs. Vertical orange lines highlight songs while skyblue boxes show the frequency-time position of individual elements. The sound file can be found at https://xeno-canto.org/15607." width="100%"><p class="caption">
Annotated spectrogram of Scale-throated Hermit songs. Vertical orange
lines highlight songs while skyblue boxes show the frequency-time
position of individual elements. The sound file can be found at <a href="https://xeno-canto.org/15607" class="external-link uri">https://xeno-canto.org/15607</a>.
</p>
</div>
<p>An example sound file with this species’ song can be downloaded as
follows (the sound file can also be downloaded manually from <a href="https://xeno-canto.org/15607/download" class="external-link">this link</a>):</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sth_annotations"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># download sound file from Xeno-Canto using catalog id</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/query_xc.html">query_xc</a></span><span class="op">(</span>qword <span class="op">=</span> <span class="st">"nr:15607"</span>,</span>
<span>           download <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check file is found in temporary directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"mp3"</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] "Phaethornis-eurynome-15607.mp3"</code></pre>
<p><strong>warbleR</strong> comes with an example data set containing
annotations on this sound file, which can be loaded like this:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load  Scale-throated Hermit example annotations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sth_annotations"</span><span class="op">)</span></span></code></pre></div>
<p>Note that these annotations contain an additional column called
‘song’, with the song ID labels for elements (rows) belonging to the
same song:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># print into the console</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sth_annotations</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
sound.files
</th>
<th style="text-align:right;">
selec
</th>
<th style="text-align:right;">
channel
</th>
<th style="text-align:right;">
start
</th>
<th style="text-align:right;">
end
</th>
<th style="text-align:right;">
bottom.freq
</th>
<th style="text-align:right;">
top.freq
</th>
<th style="text-align:right;">
song
</th>
<th style="text-align:left;">
element
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Phaethornis-eurynome-15607.mp3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.774
</td>
<td style="text-align:right;">
0.952
</td>
<td style="text-align:right;">
4.08
</td>
<td style="text-align:right;">
8.49
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
a
</td>
</tr>
<tr>
<td style="text-align:left;">
Phaethornis-eurynome-15607.mp3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.976
</td>
<td style="text-align:right;">
1.152
</td>
<td style="text-align:right;">
2.98
</td>
<td style="text-align:right;">
9.15
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
b
</td>
</tr>
<tr>
<td style="text-align:left;">
Phaethornis-eurynome-15607.mp3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.808
</td>
<td style="text-align:right;">
2.984
</td>
<td style="text-align:right;">
4.30
</td>
<td style="text-align:right;">
6.95
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
a
</td>
</tr>
<tr>
<td style="text-align:left;">
Phaethornis-eurynome-15607.mp3
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3.009
</td>
<td style="text-align:right;">
3.185
</td>
<td style="text-align:right;">
2.98
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
b
</td>
</tr>
<tr>
<td style="text-align:left;">
Phaethornis-eurynome-15607.mp3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4.201
</td>
<td style="text-align:right;">
4.382
</td>
<td style="text-align:right;">
4.08
</td>
<td style="text-align:right;">
6.95
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
a
</td>
</tr>
<tr>
<td style="text-align:left;">
Phaethornis-eurynome-15607.mp3
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4.401
</td>
<td style="text-align:right;">
4.572
</td>
<td style="text-align:right;">
3.20
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
b
</td>
</tr>
</tbody>
</table>
<p>These data (annotations + sound file) can be used to create a ‘by
song’ extended selection table. To do this the name of the column
containing the ‘song’ level labels must be supplied to the argument
‘by.song’:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create by song extended selection table</span></span>
<span><span class="va">bs_est</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/selection_table.html">selection_table</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">sth_annotations</span>,</span>
<span>                  extended <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  by.song <span class="op">=</span> <span class="st">"song"</span>, </span>
<span>                  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code> [30mchecking selections (step 1 of 2): [39m</code></pre>
<pre><code> [30msaving wave objects into extended selection table (step 2 of 2): [39m</code></pre>
<p>In a ‘by song’ extended selection table there are as many wave
objects as songs in our annotation data:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bs_est</span>, <span class="st">"wave.objects"</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">bs_est</span><span class="op">$</span><span class="va">sound.files</span>, <span class="va">bs_est</span><span class="op">$</span><span class="va">song</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] TRUE</code></pre>
<p>We can extract an entire wave object to check that two elements are
actually included:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract wave object</span></span>
<span><span class="va">wave_song1</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/read_sound_file.html">read_sound_file</a></span><span class="op">(</span></span>
<span>    X <span class="op">=</span> <span class="va">bs_est</span>,</span>
<span>    index <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    from <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    to <span class="op">=</span> <span class="cn">Inf</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># plot spectro</span></span>
<span><span class="fu">seewave</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/seewave/man/spectro.html" class="external-link">spectro</a></span><span class="op">(</span></span>
<span>  <span class="va">wave_song1</span>,</span>
<span>  wl <span class="op">=</span> <span class="fl">150</span>,</span>
<span>  grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ovlp <span class="op">=</span> <span class="fl">90</span>,</span>
<span>  palette <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="va"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span>,</span>
<span>  collevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">0</span> , <span class="fl">5</span><span class="op">)</span>,</span>
<span>  flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="annotation_data_format_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>Note that ‘by song’ extended selection tables can be converted into
‘by element’ tables using the function
<code><a href="../reference/by_element_est.html">by_element_est()</a></code>.</p>
</div>
<div class="section level4">
<h4 id="performance">Performance<a class="anchor" aria-label="anchor" href="#performance"></a>
</h4>
<p>The use of <em>extended_selection_table</em> objects can improve
performance (in our case, measured as time). Here we use
<strong>microbenchmark</strong> to compare the performance of
<code><a href="../reference/sig2noise.html">sig2noise()</a></code> and <strong>ggplot2</strong> to plot the
results. First, a selection table with 1000 selections is created simply
by repeating the sample data frame several times and then is converted
to an extended selection table:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create long selection table</span></span>
<span><span class="va">lng.selec.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">10</span>, <span class="va">lbh_selec_table</span>,</span>
<span>                                            simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># relabels selec</span></span>
<span><span class="va">lng.selec.table</span><span class="op">$</span><span class="va">selec</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lng.selec.table</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create extended selection table</span></span>
<span><span class="va">lng_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/selection_table.html">selection_table</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">lng.selec.table</span>,</span>
<span>                           pb <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                           extended <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/" class="external-link">microbenchmark</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check performance</span></span>
<span><span class="va">mbmrk.snr</span> <span class="op">&lt;-</span> <span class="fu">microbenchmark</span><span class="op">(</span></span>
<span>  extended <span class="op">=</span> <span class="fu"><a href="../reference/sig2noise.html">sig2noise</a></span><span class="op">(</span><span class="va">lng_est</span>,</span>
<span>                       mar <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  regular <span class="op">=</span> <span class="fu"><a href="../reference/sig2noise.html">sig2noise</a></span><span class="op">(</span><span class="va">lng.selec.table</span>,</span>
<span>                      mar <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">50</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">mbmrk.snr</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"sig2noise"</span><span class="op">)</span></span></code></pre></div>
<center>
<div class="float">
<img src="microbenchmark.png" alt="autodetec image example"><div class="figcaption">autodetec image example</div>
</div>
</center>
<p>The function runs much faster in the extended selection tables.
Performance gain is likely to improve when longer recordings and data
sets are used (that is, to compensate for computing overhead).</p>
</div>
<div class="section level4">
<h4 id="sharing-acoustic-data">Sharing acoustic data<a class="anchor" aria-label="anchor" href="#sharing-acoustic-data"></a>
</h4>
<p>This new object class allows to share complete data sets, including
acoustic data. To do this we can make use of the RDS file format to save
extended selection tables. These files can be easily shared with others,
allowing to share a entire acoustic data set in a single file, something
that can be tricky when dealing with acoustic data. For example, the
following code downloads an extended selection table of inquiry calls
from Spix’s disc-winged bats used in <a href="https://marce10.github.io/publication/araya-salas-2020/" class="external-link">Araya-Salas
<em>et al</em> (2020)</a> (it can take a few minutes! Can also be
manually downloaded from <a href="https://figshare.com/ndownloader/files/21167052" class="external-link">here</a>):</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">URL</span> <span class="op">&lt;-</span> <span class="st">"https://figshare.com/ndownloader/files/21167052"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="va">URL</span>,</span>
<span>  destfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"est_inquiry.RDS"</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"wget"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"est_inquiry.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 336</code></pre>
<p>This data is ready to be used. For instance, here I create a
multipanel graph with the spectrograms of the first 6 selections:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">wv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_wave.html">read_wave</a></span><span class="op">(</span></span>
<span>    X <span class="op">=</span> <span class="va">est</span>,</span>
<span>    index <span class="op">=</span> <span class="va">i</span>,</span>
<span>    from <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    to <span class="op">=</span> <span class="fl">0.17</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/seewave/man/spectro.html" class="external-link">spectro</a></span><span class="op">(</span></span>
<span>    <span class="va">wv</span>,</span>
<span>    grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    scale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    axisX <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    axisY <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    ovlp <span class="op">=</span> <span class="fl">90</span>,</span>
<span>    flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>    palette <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="va"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span>,</span>
<span>    collevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">0</span> , <span class="fl">5</span><span class="op">)</span>  </span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="annotation_data_format_files/figure-html/unnamed-chunk-20-1.png" width="750"></p>
<p>We can also measured pairwise cross correlation (for simplicity only
on the first 4 rows):</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xcorr_inquiry</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_correlation.html">cross_correlation</a></span><span class="op">(</span><span class="va">est</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xcorr_inquiry</span></span></code></pre></div>
<pre><code> [30mcreating spectrogram matrices (step 1 of 2): [39m</code></pre>
<pre><code> [30mrunning cross-correlation (step 2 of 2): [39m</code></pre>
<table class="table table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
T2018-01-04_11-37-50_0000010.wav_1-1
</th>
<th style="text-align:right;">
T2018-01-04_11-37-50_0000010.wav_10-1
</th>
<th style="text-align:right;">
T2018-01-04_11-37-50_0000010.wav_11-1
</th>
<th style="text-align:right;">
T2018-01-04_11-37-50_0000010.wav_12-1
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
T2018-01-04_11-37-50_0000010.wav_1-1
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.522
</td>
<td style="text-align:right;">
0.535
</td>
<td style="text-align:right;">
0.594
</td>
</tr>
<tr>
<td style="text-align:left;">
T2018-01-04_11-37-50_0000010.wav_10-1
</td>
<td style="text-align:right;">
0.522
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.869
</td>
<td style="text-align:right;">
0.660
</td>
</tr>
<tr>
<td style="text-align:left;">
T2018-01-04_11-37-50_0000010.wav_11-1
</td>
<td style="text-align:right;">
0.535
</td>
<td style="text-align:right;">
0.869
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.833
</td>
</tr>
<tr>
<td style="text-align:left;">
T2018-01-04_11-37-50_0000010.wav_12-1
</td>
<td style="text-align:right;">
0.594
</td>
<td style="text-align:right;">
0.660
</td>
<td style="text-align:right;">
0.833
</td>
<td style="text-align:right;">
1.000
</td>
</tr>
</tbody>
</table>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<ul>
<li>Araya-Salas (2017), <em>Rraven: connecting R and Raven bioacoustic
software</em>. R package version 1.0.2.</li>
<li>Araya-Salas, M., Hernández-Pinsón, H. A., Rojas, N., &amp; Chaverri,
G. (2020). <em>Ontogeny of an interactive call-and-response system in
Spix’s disc-winged bats</em>. Animal Behaviour, 166, 233-245.</li>
</ul>
<hr>
<p><font size="4">Session information</font></p>
<pre><code>R version 4.3.3 (2024-02-29)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 22.04.4 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 
LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0

locale:
 [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8        LC_COLLATE=C.UTF-8    
 [5] LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8    LC_PAPER=C.UTF-8       LC_NAME=C             
 [9] LC_ADDRESS=C           LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   

time zone: UTC
tzcode source: system (glibc)

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] kableExtra_1.4.0   warbleR_1.1.30     NatureSounds_1.0.4 knitr_1.45         seewave_2.2.3     
[6] tuneR_1.4.6       

loaded via a namespace (and not attached):
 [1] gtable_0.3.4      rjson_0.2.21      xfun_0.43         bslib_0.6.2       ggplot2_3.5.0    
 [6] vctrs_0.6.5       tools_4.3.3       bitops_1.0-7      parallel_4.3.3    tibble_3.2.1     
[11] proxy_0.4-27      fansi_1.0.6       highr_0.10        pkgconfig_2.0.3   desc_1.4.3       
[16] lifecycle_1.0.4   compiler_4.3.3    stringr_1.5.1     textshaping_0.3.7 brio_1.1.4       
[21] munsell_0.5.0     codetools_0.2-19  htmltools_0.5.8   sass_0.4.9        RCurl_1.98-1.14  
[26] yaml_2.3.8        pkgdown_2.0.7     pillar_1.9.0      jquerylib_0.1.4   MASS_7.3-60.0.1  
[31] cachem_1.0.8      iterators_1.0.14  viridis_0.6.5     foreach_1.5.2     digest_0.6.35    
[36] stringi_1.8.3     purrr_1.0.2       fastmap_1.1.1     grid_4.3.3        colorspace_2.1-0 
[41] cli_3.6.2         magrittr_2.0.3    utf8_1.2.4        shinyBS_0.61.1    scales_1.3.0     
[46] rmarkdown_2.26    signal_1.8-0      gridExtra_2.3     ragg_1.3.0        memoise_2.0.1    
[51] pbapply_1.7-2     evaluate_0.23     dtw_1.23-1        fftw_1.0-8        testthat_3.2.1   
[56] viridisLite_0.4.2 rlang_1.1.3       Rcpp_1.0.12       glue_1.7.0        xml2_1.3.6       
[61] svglite_2.1.3     rstudioapi_0.16.0 jsonlite_1.8.8    soundgen_2.6.2    R6_2.5.1         
[66] systemfonts_1.0.6 fs_1.6.3         </code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marcelo Araya-Salas, Grace Smith-Vidaurre.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
