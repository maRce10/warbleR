<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="warbleR">
<title>
<font size="7"><b>warbleR: Import sound files and select signals</b></font> • warbleR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="&lt;font size=">
</head>
<body>
<b>warbleR: Import sound files and select signals</b>" /&gt;
<meta property="og:description" content="warbleR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">warbleR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.29</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>vignettes</h6>
    <a class="dropdown-item" href="../articles/Intro_to_warbleR.html">&lt;font size="7"&gt;&lt;b&gt;Introduction to warbleR&lt;/b&gt;&lt;/font&gt;</a>
    <a class="dropdown-item" href="../articles/warbleR_workflow_01.html">&lt;font size="7"&gt;&lt;b&gt;warbleR&amp;#58; Import sound files and select signals&lt;/b&gt;&lt;/font&gt;</a>
    <a class="dropdown-item" href="../articles/warbleR_workflow_02.html">&lt;font size="7"&gt;&lt;b&gt;"warbleR&amp;#58; Visual inspection and signal classification&lt;/b&gt;&lt;/font&gt;</a>
    <a class="dropdown-item" href="../articles/warbleR_workflow_03.html">&lt;font size="7"&gt;&lt;b&gt;warbleR&amp;#58; Acoustic (dis)similarity, coordinated singing and simulating songs&lt;/b&gt;&lt;/font&gt;</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/maRce10/warbleR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1><font size="7"><b>warbleR: Import sound files and select signals</b></font></h1>
                        <h4 data-toc-skip class="author">
<a href="https://marce10.github.io" class="external-link">Marcelo
Araya-Salas, PhD</a> &amp; <a href="https://smith-vidaurre.com/" class="external-link">Grace
Smith-Vidaurre</a>
</h4>
            
            <h4 data-toc-skip class="date">2023-10-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/maRce10/warbleR/blob/HEAD/vignettes/warbleR_workflow_01.Rmd" class="external-link"><code>vignettes/warbleR_workflow_01.Rmd</code></a></small>
      <div class="d-none name"><code>warbleR_workflow_01.Rmd</code></div>
    </div>

    
    
<!-- <script> -->
<!--    $(document).ready(function() { -->
<!--      $head = $('#header'); -->
<!--      $head.prepend('<img src=\"logo.png\"/>') -->
<!--    }); -->
<!-- </script> -->
<!-- &nbsp;  -->
<style type="text/css">
div#header h1.title, div#header h3.subtitle, div#header h4.author, div#header h4.date {
  text-align: center
}
</style>
<div class="section level2">
<h2 id="bioacoustics-in-r-with-warbler">Bioacoustics in R with <code>warbleR</code><a class="anchor" aria-label="anchor" href="#bioacoustics-in-r-with-warbler"></a>
</h2>
<p><img src="warbleR_sticker.png" alt="warbleR logo" align="right" width="25%" height="25%"></p>
<p>Bioacoustics research encompasses a wide range of questions, study
systems and methods, including the software used for analyses. The
<code>warbleR</code> and <code>Rraven</code> packages leverage the
flexibility of the <code>R</code> environment to offer a broad and
accessible bioinformatics tool set. These packages fundamentally rely
upon two types of data to perform bioacoustics analyses in R:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Sound files:</strong> Recordings in <em>wav</em> or
<em>mp3</em> format, either from your own research or open-access
databases like <em>xeno-canto</em></p></li>
<li><p><strong>Selection tables:</strong> Selection tables contain the
temporal coordinates (start and end points) of selected acoustic signals
within recordings</p></li>
</ol>
<div class="section level3">
<h3 id="package-repositories">Package repositories<a class="anchor" aria-label="anchor" href="#package-repositories"></a>
</h3>
<p>These packages are both available on <em>CRAN</em>: <a href="https://cran.r-project.org/package=warbleR" class="external-link"><code>warbleR</code></a>,
<a href="https://cran.r-project.org/package=Rraven" class="external-link"><code>Rraven</code></a>,
as well as on <em>GitHub</em>: <a href="https://github.com/maRce10/warbleR" class="external-link"><code>warbleR</code></a>, <a href="https://github.com/maRce10/Rraven" class="external-link"><code>Rraven</code></a>. The
GitHub repository will always contain the latest functions and updates.
You can also check out an article in <em>Methods in Ecology and
Evolution</em> documenting the <code>warbleR</code> package
<a href="#References"><sup>[1]</sup></a>.</p>
<p>We welcome all users to provide feedback, contribute updates or new
functions and report bugs to warbleR’s GitHub repository.</p>
<p>Please note that <code>warbleR</code> and <code>Rraven</code> use
functions from the <a href="https://cran.r-project.org/package=seewave" class="external-link"><code>seewave</code></a>,
<a href="https://cran.r-project.org/package=monitoR" class="external-link"><code>monitoR</code></a>,
<a href="https://cran.r-project.org/package=tuneR" class="external-link"><code>tuneR</code></a>
and <a href="https://cran.r-project.org/package=dtw" class="external-link"><code>dtw</code></a>
packages internally. <code>warbleR</code> and <code>Rraven</code> have
been designed to make bioacoustics analyses more accessible to
<code>R</code> users, and such analyses would not be possible without
the tools provided by the packages above. These packages should be given
credit when using <code>warbleR</code> and <code>Rraven</code> by
including citations in publications as appropriate
(e.g. <code>citation("seewave")</code>).</p>
</div>
<div class="section level3">
<h3 id="parallel-processing-in-warbler">Parallel processing in <code>warbleR</code><a class="anchor" aria-label="anchor" href="#parallel-processing-in-warbler"></a>
</h3>
<p>Parallel processing, or using multiple cores on your machine, can
greatly speed up analyses. All iterative <code>warbleR</code> functions
now have parallel processing for Linux, Mac and Windows operating
systems. These functions also contain progress bars to visualize
progress during normal or parallel processing. See
<a href="#References"><sup>[1]</sup></a> for more details about improved
running time using parallel processing.</p>
</div>
</div>
<div class="section level2">
<h2 id="vignette-introduction">
<strong>Vignette introduction</strong><a class="anchor" aria-label="anchor" href="#vignette-introduction"></a>
</h2>
<p>Below we present a case study of microgeographic vocal variation in
long-billed hermit hummingbirds, <em>Phaethornis longirostris</em>.
Variation at small geographic scales has been already described in this
species <a href="#References"><sup>[2]</sup></a>. Our goal is to search
for visible differences in song structure within a site, and then
determine whether underlying differences in acoustic parameters are
representative of spectrographic distinctiveness. In this vignette, we
will demonstrate how to:</p>
<ol style="list-style-type: decimal">
<li><p>Prepare for bioacoustics analyses by downloading
<code>warbleR</code> and <code>Rraven</code></p></li>
<li><p>Use <code>Rraven</code> to import <em>Raven</em> selection tables
for your own recordings</p></li>
<li><p>Obtain recordings from the open-access database <a href="https://www.xeno-canto.org/" class="external-link"><em>xeno-canto</em></a></p></li>
<li><p>Select signals using <code>warbleR</code> functions</p></li>
</ol>
<p>This vignette can be run without an advanced understanding of
<code>R</code>, as long as you know how to run code in your console.
However, knowing more about basic <code>R</code> coding would be very
helpful to modify the code for your research questions.</p>
<p>For more details about function arguments, input or output, read the
documentation for the function in question
(e.g. <code><a href="../reference/query_xc.html">?query_xc</a></code>).  </p>
</div>
<div class="section level2">
<h2 id="prepare-for-analyses">
<strong>Prepare for analyses</strong><a class="anchor" aria-label="anchor" href="#prepare-for-analyses"></a>
</h2>
<div class="section level3">
<h3 id="install-and-load-packages">Install and load packages<a class="anchor" aria-label="anchor" href="#install-and-load-packages"></a>
</h3>
<p>First, we need to install and load <code>warbleR</code> and
<code>Rraven</code>. You will need an <code>R</code> version .1 and
<code>seewave</code> version .1. Also, users using <code>UNIX</code>
machines (Linux or Mac operating systems), may need to install
<code>fftw3</code>, <code>pkg-config</code> and <code>libsndfile</code>
on their machines prior to installing <code>warbleR</code>. These
external packages will need to be installed through a <code>UNIX</code>
terminal. Installing these packages lies outside the scope of this
vignette, but you can find more information on <em>Google</em>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### Install packages from CRAN</span></span>
<span><span class="co"># Note that if you install from CRAN, then don't run the code to install from GitHub below, and vice versa</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"warbleR"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"Rraven"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### Alternatively, install warbleR and Rraven from GitHub repositories, which contain the latest updates</span></span>
<span><span class="co"># Run this ONLY if devtools is not already installed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load devtools to access the install_github function</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install packages from GitHub</span></span>
<span><span class="co"># install_github("maRce10/warbleR")</span></span>
<span><span class="co"># install_github("maRce10/Rraven")</span></span>
<span><span class="co"># install_github("maRce10/NatureSounds")</span></span>
<span></span>
<span><span class="co"># Load warbleR and Rraven into your global environment</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"warbleR"</span>, <span class="st">"Rraven"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">library</span>, character.only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This vignette series will not always include all available
<code>warbleR</code> functions, as existing functions are updated and
new functions are added. To see all functions available in this
package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The package must be loaded in your working environment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="st">"package:warbleR"</span><span class="op">)</span></span></code></pre></div>
<p> </p>
</div>
<div class="section level3">
<h3 id="make-a-new-directory-and-set-your-working-directory">Make a new directory and set your working directory<a class="anchor" aria-label="anchor" href="#make-a-new-directory-and-set-your-working-directory"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a new directory and set your working directory (assuming that you are in your /home/username directory)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"warbleR_example"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"warbleR_example"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check your location</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p> </p>
</div>
</div>
<div class="section level2">
<h2 id="import-selection-tables">
<strong>Import selection tables</strong><a class="anchor" aria-label="anchor" href="#import-selection-tables"></a>
</h2>
<p><code>Rraven</code> is an interface between <em>Raven</em> and
<code>R</code> that allows you to import selection tables for your own
recordings. This is very useful if you prefer to select signals in
recordings outside of <code>R</code>. Once you have selection tables
imported into <code>R</code> and the corresponding sound files in your
working directory, you can move on to making spectrograms or performing
analyses (see the next vignette in this series).</p>
<p>The sound files and selection tables loaded here correspond to male
long-billed hermit hummingbird songs recorded at La Selva Biological
Station in Costa Rica. Later, we will add to this data set by searching
for more recordings on the <em>xeno-canto</em> open-access database.</p>
<p>Check out the <code>Rraven</code> package documentation for more
functions and information (although you will need <em>Raven</em> or
<em>Syrinx</em> installed on your computer for some functions).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load Raven example selection tables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"selection_files"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Write out Raven example selection tables as physical files</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">selection_files</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, con <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">selection_files</span><span class="op">)</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Write example sound files out as physical .wav files</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Phae.long1"</span>, <span class="st">"Phae.long2"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tuneR/man/writeWave.html" class="external-link">writeWave</a></span><span class="op">(</span><span class="va">Phae.long1</span>, <span class="st">"Phae.long1.wav"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tuneR/man/writeWave.html" class="external-link">writeWave</a></span><span class="op">(</span><span class="va">Phae.long2</span>, <span class="st">"Phae.long2.wav"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import selections</span></span>
<span><span class="va">sels</span> <span class="op">&lt;-</span> <span class="fu">imp_raven</span><span class="op">(</span>all.data <span class="op">=</span> <span class="cn">FALSE</span>, freq.cols <span class="op">=</span> <span class="cn">FALSE</span>, warbler.format <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sels</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Write out the imported selections as a .csv for later use</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">sels</span>, <span class="st">"Raven_sels.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="make-your-data-frame-into-an-object-of-class-selection-table">Make your data frame into an object of class
<code>selection table</code><a class="anchor" aria-label="anchor" href="#make-your-data-frame-into-an-object-of-class-selection-table"></a>
</h3>
<p>Downstream <code>warbleR</code> functions require selection tables in
order to run correctly. Use the function <code>selection_table</code> to
convert your data frame into an object of class
<code>selection_table</code>. In future versions of
<code>warbleR</code>, all functions will require selection table objects
of class <code>selection_table</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/selection_table.html">selection_table</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">sels</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sels</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">sels</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="obtain-metadata-and-recordings-from-xeno-canto">
<strong>Obtain metadata and recordings from <a href="https://www.xeno-canto.org/" class="external-link">xeno-canto</a></strong><a class="anchor" aria-label="anchor" href="#obtain-metadata-and-recordings-from-xeno-canto"></a>
</h2>
<p>The open-access <a href="https://www.xeno-canto.org/" class="external-link">xeno-canto</a>
database is an excellent source of sound files across avian species. You
can query this database by a species or genus of interest. The function
<code>query_xc</code> has two types of output:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Metadata of recordings:</strong> geographic coordinates,
recording quality, recordist, type of signal, etc.</p></li>
<li><p><strong>Sound files:</strong> Sound files in <em>mp3</em> format
are returned if the argument <code>download</code> is set to
<code>TRUE</code>.</p></li>
</ol>
<p>We recommend downloading metadata first from <em>xeno-canto</em>, as
this data can be filtered in R to more efficiently download recordings
(e.g. only those relevant to your question).</p>
<p>Here, we will query the <em>xeno-canto</em> database to download more
<em>Phaethornis longirostris</em> sound files for our question of how
male songs vary at a microgeographic scale.</p>
<p> </p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Query xeno-canto for all Phaethornis recordings (e.g., by genus)</span></span>
<span><span class="va">Phae</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_xc.html">query_xc</a></span><span class="op">(</span>qword <span class="op">=</span> <span class="st">"Phaethornis"</span>, download <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check out the structure of resulting the data frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">Phae</span><span class="op">)</span></span></code></pre></div>
<pre><code>'data.frame':   899 obs. of  36 variables:
 $ Recording_ID     : int  406968 403856 403854 387711 275252 261696 261695 261694 261693 261692 ...
 $ Genus            : chr  "Phaethornis" "Phaethornis" "Phaethornis" "Phaethornis" ...
 $ Specific_epithet : chr  "yaruqui" "yaruqui" "yaruqui" "yaruqui" ...
 $ Subspecies       : chr  "" "" "" "" ...
 $ English_name     : chr  "White-whiskered Hermit" "White-whiskered Hermit" "White-whiskered Hermit" "White-whiskered Hermit" ...
 $ Recordist        : chr  "Myornis" "Myornis" "Myornis" "Jerome Fischer" ...
 $ Country          : chr  "Colombia" "Colombia" "Colombia" "Ecuador" ...
 $ Locality         : chr  "La Chocoana, Guachalito, Nuquí, Chocó" "La Chocoana, Guachalito, Nuquí, Chocó" "La Chocoana, Guachalito, Nuquí, Chocó" "Amagusa Reserve Pichincha" ...
 $ Latitude         : num  5.627 5.627 5.627 0.161 0.75 ...
 $ Longitude        : num  -77.4 -77.4 -77.4 -78.9 -78.9 ...
 $ Vocalization_type: chr  "flight call" "flight call" "flight call" "song" ...
 $ Audio_file       : chr  "//www.xeno-canto.org/406968/download" "//www.xeno-canto.org/403856/download" "//www.xeno-canto.org/403854/download" "//www.xeno-canto.org/387711/download" ...
 $ License          : chr  "//creativecommons.org/licenses/by-nc-sa/4.0/" "//creativecommons.org/licenses/by-nc-sa/4.0/" "//creativecommons.org/licenses/by-nc-sa/4.0/" "//creativecommons.org/licenses/by-nc-sa/4.0/" ...
 $ Url              : chr  "//www.xeno-canto.org/406968" "//www.xeno-canto.org/403856" "//www.xeno-canto.org/403854" "//www.xeno-canto.org/387711" ...
 $ Quality          : chr  "A" "A" "A" "A" ...
 $ Time             : chr  "?" "?" "?" "09:00" ...
 $ Date             : chr  "2018-08-00" "2017-08-00" "2017-08-00" "2017-09-24" ...
 $ Altitude         : chr  "30" "10" "10" "1300" ...
 $ Spectrogram_small: chr  "//www.xeno-canto.org/sounds/uploaded/OXSIOLJJUP/ffts/XC406968-small.png" "//www.xeno-canto.org/sounds/uploaded/OXSIOLJJUP/ffts/XC403856-small.png" "//www.xeno-canto.org/sounds/uploaded/OXSIOLJJUP/ffts/XC403854-small.png" "//www.xeno-canto.org/sounds/uploaded/JPBSNBUUEF/ffts/XC387711-small.png" ...
 $ Spectrogram_med  : chr  "//www.xeno-canto.org/sounds/uploaded/OXSIOLJJUP/ffts/XC406968-med.png" "//www.xeno-canto.org/sounds/uploaded/OXSIOLJJUP/ffts/XC403856-med.png" "//www.xeno-canto.org/sounds/uploaded/OXSIOLJJUP/ffts/XC403854-med.png" "//www.xeno-canto.org/sounds/uploaded/JPBSNBUUEF/ffts/XC387711-med.png" ...
 $ Spectrogram_large: chr  "//www.xeno-canto.org/sounds/uploaded/OXSIOLJJUP/ffts/XC406968-large.png" "//www.xeno-canto.org/sounds/uploaded/OXSIOLJJUP/ffts/XC403856-large.png" "//www.xeno-canto.org/sounds/uploaded/OXSIOLJJUP/ffts/XC403854-large.png" "//www.xeno-canto.org/sounds/uploaded/JPBSNBUUEF/ffts/XC387711-large.png" ...
 $ Spectrogram_full : chr  "//www.xeno-canto.org/sounds/uploaded/OXSIOLJJUP/ffts/XC406968-full.png" "//www.xeno-canto.org/sounds/uploaded/OXSIOLJJUP/ffts/XC403856-full.png" "//www.xeno-canto.org/sounds/uploaded/OXSIOLJJUP/ffts/XC403854-full.png" "//www.xeno-canto.org/sounds/uploaded/JPBSNBUUEF/ffts/XC387711-full.png" ...
 $ Length           : chr  "0:02" "0:04" "0:01" "0:50" ...
 $ Uploaded         : chr  "2018-03-23" "2018-02-28" "2018-02-28" "2017-09-27" ...
 $ Other_species    : chr  "" "Coereba flaveola" "" "" ...
 $ Remarks          : chr  "In forest." "Forest border." "Forest border." "" ...
 $ Bird_seen        : chr  "yes" "yes" "yes" "yes" ...
 $ Playback_used    : chr  "no" "no" "no" "no" ...
 $ Other_species1   : chr  NA NA NA NA ...
 $ Other_species2   : chr  NA NA NA NA ...
 $ Other_species3   : chr  NA NA NA NA ...
 $ Other_species4   : chr  NA NA NA NA ...
 $ Other_species5   : chr  NA NA NA NA ...
 $ Other_species6   : chr  NA NA NA NA ...
 $ Other_species7   : chr  NA NA NA NA ...
 $ Other_species8   : chr  NA NA NA NA ...</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Query xeno-canto for all Phaethornis longirostris recordings</span></span>
<span><span class="va">Phae.lon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_xc.html">query_xc</a></span><span class="op">(</span>qword <span class="op">=</span> <span class="st">"Phaethornis longirostris"</span>, download <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check out the structure of resulting the data frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">Phae.lon</span><span class="op">)</span></span></code></pre></div>
<pre><code>'data.frame':   85 obs. of  31 variables:
 $ Recording_ID     : int  497036 495384 433645 402755 355350 282529 274377 271499 154138 154129 ...
 $ Genus            : chr  "Phaethornis" "Phaethornis" "Phaethornis" "Phaethornis" ...
 $ Specific_epithet : chr  "longirostris" "longirostris" "longirostris" "longirostris" ...
 $ Subspecies       : chr  "" "cephalus" "" "" ...
 $ English_name     : chr  "Long-billed Hermit" "Long-billed Hermit" "Long-billed Hermit" "Long-billed Hermit" ...
 $ Recordist        : chr  "Jerome Fischer" "Guy Kirwan" "Oscar Campbell" "Marilyn Castillo" ...
 $ Country          : chr  "Panama" "Panama" "Panama" "Mexico" ...
 $ Locality         : chr  "Achiote Road, Colón Province" "Panama Rainforest Discovery Centre" "Panama Rainforest Discovery Centre" "Boca de Chajul, Marqués de Comillas, Chiapas" ...
 $ Latitude         : num  9.2 9.13 9.13 16.13 8.94 ...
 $ Longitude        : num  -80 -79.7 -79.7 -90.9 -78.5 ...
 $ Vocalization_type: chr  "song" "call" "song" "alarm call" ...
 $ Audio_file       : chr  "//www.xeno-canto.org/497036/download" "//www.xeno-canto.org/495384/download" "//www.xeno-canto.org/433645/download" "//www.xeno-canto.org/402755/download" ...
 $ License          : chr  "//creativecommons.org/licenses/by-nc-sa/4.0/" "//creativecommons.org/licenses/by-nc-sa/4.0/" "//creativecommons.org/licenses/by-nc-sa/4.0/" "//creativecommons.org/licenses/by-nc-nd/4.0/" ...
 $ Url              : chr  "//www.xeno-canto.org/497036" "//www.xeno-canto.org/495384" "//www.xeno-canto.org/433645" "//www.xeno-canto.org/402755" ...
 $ Quality          : chr  "no score" "A" "A" "A" ...
 $ Time             : chr  "09:30" "09:00" "08:30" "07:30" ...
 $ Date             : chr  "2019-02-10" "2019-07-04" "2018-07-10" "2016-01-18" ...
 $ Altitude         : chr  "30" "70" "70" "180" ...
 $ Spectrogram_small: chr  "//www.xeno-canto.org/sounds/uploaded/JPBSNBUUEF/ffts/XC497036-small.png" "//www.xeno-canto.org/sounds/uploaded/BZVYBRUAAE/ffts/XC495384-small.png" "//www.xeno-canto.org/sounds/uploaded/RFRTVEHIZX/ffts/XC433645-small.png" "//www.xeno-canto.org/sounds/uploaded/CHRIDPJVMH/ffts/XC402755-small.png" ...
 $ Spectrogram_med  : chr  "//www.xeno-canto.org/sounds/uploaded/JPBSNBUUEF/ffts/XC497036-med.png" "//www.xeno-canto.org/sounds/uploaded/BZVYBRUAAE/ffts/XC495384-med.png" "//www.xeno-canto.org/sounds/uploaded/RFRTVEHIZX/ffts/XC433645-med.png" "//www.xeno-canto.org/sounds/uploaded/CHRIDPJVMH/ffts/XC402755-med.png" ...
 $ Spectrogram_large: chr  "//www.xeno-canto.org/sounds/uploaded/JPBSNBUUEF/ffts/XC497036-large.png" "//www.xeno-canto.org/sounds/uploaded/BZVYBRUAAE/ffts/XC495384-large.png" "//www.xeno-canto.org/sounds/uploaded/RFRTVEHIZX/ffts/XC433645-large.png" "//www.xeno-canto.org/sounds/uploaded/CHRIDPJVMH/ffts/XC402755-large.png" ...
 $ Spectrogram_full : chr  "//www.xeno-canto.org/sounds/uploaded/JPBSNBUUEF/ffts/XC497036-full.png" "//www.xeno-canto.org/sounds/uploaded/BZVYBRUAAE/ffts/XC495384-full.png" "//www.xeno-canto.org/sounds/uploaded/RFRTVEHIZX/ffts/XC433645-full.png" "//www.xeno-canto.org/sounds/uploaded/CHRIDPJVMH/ffts/XC402755-full.png" ...
 $ Length           : chr  "0:27" "0:49" "0:58" "0:03" ...
 $ Uploaded         : chr  "2019-09-13" "2019-09-01" "2018-09-09" "2018-02-14" ...
 $ Other_species    : chr  "" "" "" "" ...
 $ Remarks          : chr  "" "Lek with up to three different individuals. Focal bird was perched 1.5 m above ground on a 45-degree angle twig." "Male seen on lek; 3 feet above ground in gap in undergrowth. Calling incessantly and quivering tail as doing so"| __truncated__ "" ...
 $ Bird_seen        : chr  "yes" "yes" "yes" "yes" ...
 $ Playback_used    : chr  "no" "no" "no" "no" ...
 $ Other_species1   : chr  NA NA NA NA ...
 $ Other_species2   : chr  NA NA NA NA ...
 $ Other_species3   : chr  NA NA NA NA ...</code></pre>
<p> </p>
<p>You can then use the function <code>map_xc</code> to visualize the
geographic spread of the queried recordings. <code>map_xc</code> will
create an image file of a map per species in your current directory if
<code>img = TRUE</code>. If <code>img = FALSE</code>, maps will be
displayed in the graphics device.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Image type default is jpeg, but tiff files have better resolution</span></span>
<span></span>
<span><span class="co"># When the data frame contains multiple species, this will yield one map per species</span></span>
<span><span class="fu"><a href="../reference/map_xc.html">map_xc</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">Phae</span>, img <span class="op">=</span> <span class="cn">TRUE</span>, it <span class="op">=</span> <span class="st">"tiff"</span><span class="op">)</span> <span class="co"># all species in the genus</span></span>
<span><span class="fu"><a href="../reference/map_xc.html">map_xc</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">Phae.lon</span>, img <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># a single species</span></span></code></pre></div>
<div class="section level3">
<h3 id="filter-xeno-canto-recordings-by-quality-signal-type-and-locality">Filter <a href="https://www.xeno-canto.org/" class="external-link">xeno-canto</a>
recordings by quality, signal type and locality<a class="anchor" aria-label="anchor" href="#filter-xeno-canto-recordings-by-quality-signal-type-and-locality"></a>
</h3>
<p>In most cases, you will need to filter the <em>xeno-canto</em>
metadata by type of signal you want to analyze. When you subset the
metadata, you can input the filtered metadata back into
<code>query_xc</code> to download only the selected recordings. There
are many ways to filter data in R, and the example below can be modified
to fit your own data.</p>
<p>Here, before downloading the sound files themselves from
<em>xeno-canto</em>, we want to ensure that we select high quality sound
files that contain songs (rather than other acoustic signal types) and
were also recorded at La Selva Biological Station in Costa Rica.</p>
<p> </p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many recordings are available for Phaethornis longirostris?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Phae.lon</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 85</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many signal types exist in the xeno-canto metadata?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Phae.lon</span><span class="op">$</span><span class="va">Vocalization_type</span><span class="op">)</span></span></code></pre></div>
<pre><code> [1] "song"              "call"              "alarm call"        "song at lek"       "lekking"           "flight call"       "calls"            
 [8] "300"               "song, wing whirrs" "lek, song"        </code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many recordings per signal type?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Phae.lon</span><span class="op">$</span><span class="va">Vocalization_type</span><span class="op">)</span></span></code></pre></div>
<pre><code>
              300        alarm call              call             calls       flight call         lek, song           lekking              song 
                1                 1                 6                 1                 2                 2                 1                68 
      song at lek song, wing whirrs 
                2                 1 </code></pre>
<p> </p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter the metadata to select the signals we want to retain</span></span>
<span></span>
<span><span class="co"># First by quality</span></span>
<span><span class="va">Phae.lon</span> <span class="op">&lt;-</span> <span class="va">Phae.lon</span><span class="op">[</span><span class="va">Phae.lon</span><span class="op">$</span><span class="va">Quality</span> <span class="op">==</span> <span class="st">"A"</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Phae.lon</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 12</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Then by signal type</span></span>
<span><span class="va">Phae.lon.song</span> <span class="op">&lt;-</span> <span class="va">Phae.lon</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"song"</span>, <span class="va">Phae.lon</span><span class="op">$</span><span class="va">Vocalization_type</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Phae.lon.song</span><span class="op">)</span></span></code></pre></div>
<pre><code>[1] 9</code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Finally by locality</span></span>
<span><span class="va">Phae.lon.LS</span> <span class="op">&lt;-</span> <span class="va">Phae.lon.song</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"La Selva Biological Station, Sarapiqui, Heredia"</span>, <span class="va">Phae.lon.song</span><span class="op">$</span><span class="va">Locality</span>, ignore.case <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Check resulting data frame, 6 recordings remain</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">Phae.lon.LS</span><span class="op">)</span></span></code></pre></div>
<pre><code>'data.frame':   3 obs. of  31 variables:
 $ Recording_ID     : int  154138 154129 154072
 $ Genus            : chr  "Phaethornis" "Phaethornis" "Phaethornis"
 $ Specific_epithet : chr  "longirostris" "longirostris" "longirostris"
 $ Subspecies       : chr  "" "" ""
 $ English_name     : chr  "Long-billed Hermit" "Long-billed Hermit" "Long-billed Hermit"
 $ Recordist        : chr  "Marcelo Araya-Salas" "Marcelo Araya-Salas" "Marcelo Araya-Salas"
 $ Country          : chr  "Costa Rica" "Costa Rica" "Costa Rica"
 $ Locality         : chr  "La Selva Biological Station, Sarapiqui, Heredia" "La Selva Biological Station, Sarapiqui, Heredia" "La Selva Biological Station, Sarapiqui, Heredia"
 $ Latitude         : num  10.4 10.4 10.4
 $ Longitude        : num  -84 -84 -84
 $ Vocalization_type: chr  "song" "song" "song"
 $ Audio_file       : chr  "//www.xeno-canto.org/154138/download" "//www.xeno-canto.org/154129/download" "//www.xeno-canto.org/154072/download"
 $ License          : chr  "//creativecommons.org/licenses/by-nc-sa/3.0/" "//creativecommons.org/licenses/by-nc-sa/3.0/" "//creativecommons.org/licenses/by-nc-sa/3.0/"
 $ Url              : chr  "//www.xeno-canto.org/154138" "//www.xeno-canto.org/154129" "//www.xeno-canto.org/154072"
 $ Quality          : chr  "A" "A" "A"
 $ Time             : chr  "14:18" "10:09" "7:05"
 $ Date             : chr  "2010-05-21" "2010-05-21" "2010-05-28"
 $ Altitude         : chr  "" "" ""
 $ Spectrogram_small: chr  "//www.xeno-canto.org/sounds/uploaded/EMCWQLLKEW/ffts/XC154138-small.png" "//www.xeno-canto.org/sounds/uploaded/EMCWQLLKEW/ffts/XC154129-small.png" "//www.xeno-canto.org/sounds/uploaded/EMCWQLLKEW/ffts/XC154072-small.png"
 $ Spectrogram_med  : chr  "//www.xeno-canto.org/sounds/uploaded/EMCWQLLKEW/ffts/XC154138-med.png" "//www.xeno-canto.org/sounds/uploaded/EMCWQLLKEW/ffts/XC154129-med.png" "//www.xeno-canto.org/sounds/uploaded/EMCWQLLKEW/ffts/XC154072-med.png"
 $ Spectrogram_large: chr  "//www.xeno-canto.org/sounds/uploaded/EMCWQLLKEW/ffts/XC154138-large.png" "//www.xeno-canto.org/sounds/uploaded/EMCWQLLKEW/ffts/XC154129-large.png" "//www.xeno-canto.org/sounds/uploaded/EMCWQLLKEW/ffts/XC154072-large.png"
 $ Spectrogram_full : chr  "//www.xeno-canto.org/sounds/uploaded/EMCWQLLKEW/ffts/XC154138-full.png" "//www.xeno-canto.org/sounds/uploaded/EMCWQLLKEW/ffts/XC154129-full.png" "//www.xeno-canto.org/sounds/uploaded/EMCWQLLKEW/ffts/XC154072-full.png"
 $ Length           : chr  "2:58" "2:25" "3:09"
 $ Uploaded         : chr  "2013-11-11" "2013-11-11" "2013-11-11"
 $ Other_species    : chr  "" "" ""
 $ Remarks          : chr  "Recording equipment: Marantz Pmd 660+sennheiser ME67. Comments: individuo-AK; lek-Sura. Primera parte de grabac"| __truncated__ "Recording equipment: Marantz Pmd 660+sennheiser ME67. Comments: individuo-AK; lek-Sura. video 511, revisar. 9 m"| __truncated__ "Recording equipment: Marantz Pmd 660+sennheiser ME67. Comments: individuo-VA; lek-CCL. en percha ded VA, probab"| __truncated__
 $ Bird_seen        : chr  "yes" "yes" "yes"
 $ Playback_used    : chr  "no" "no" "no"
 $ Other_species1   : chr  NA NA NA
 $ Other_species2   : chr  NA NA NA
 $ Other_species3   : chr  NA NA NA</code></pre>
<p> </p>
<p>We can check if the location coordinates make sense (all recordings
should be from a single place in Costa Rica) by making a map of these
recordings using <code>map_xc</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># map in the RStudio graphics device (img = FALSE)</span></span>
<span><span class="fu"><a href="../reference/map_xc.html">map_xc</a></span><span class="op">(</span><span class="va">Phae.lon.LS</span>, img <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p> </p>
<p>Once you’re sure you want the recordings, use <code>query_xc</code>
to download the files. Also, save the metadata as a <em>.csv</em>
file.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download sound files</span></span>
<span><span class="fu"><a href="../reference/query_xc.html">query_xc</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">Phae.lon.LS</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the metadata object as a .csv file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">Phae.lon.LS</span>, <span class="st">"Phae_lon.LS.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p> </p>
</div>
<div class="section level3">
<h3 id="convert-xeno-canto-mp3-recordings-to-wav-format">Convert <a href="https://www.xeno-canto.org/" class="external-link">xeno-canto</a>
<em>mp3</em> recordings to <em>wav</em> format<a class="anchor" aria-label="anchor" href="#convert-xeno-canto-mp3-recordings-to-wav-format"></a>
</h3>
<p><a href="https://www.xeno-canto.org/" class="external-link">xeno-canto</a> maintains
recordings in <em>mp3</em> format due to file size restrictions.
However, we require <em>wav</em> format for all downstream analyses.
Compression from <em>wav</em> to <em>mp3</em> and back involves
information losses, but recordings that have undergone this
transformation have been successfully used in research
<a href="#References"> <sup>[3]</sup></a>.</p>
<p>To convert <em>mp3</em> to <em>wav</em>, we can use the warbleR
function <code>mp32wav</code>, which relies on a underlying function
from the <a href="https://cran.r-project.org/package=tuneR" class="external-link"><code>tuneR</code></a>
package. This function does not always work (and it remains unclear as
to why!). This bug should be fixed in future versions of
<code>tuneR</code>. If RStudio aborts when running <code>mp32wav</code>,
use an <em>mp3</em> to <em>wav</em> converter online, or download the
open source software <code>Audacity</code> (available for Mac, Linux and
Windows users).</p>
<p>After <em>mp3</em> files have been converted, we need to check that
the <em>wav</em> files are not corrupted and can be read into RStudio
(some <em>wav</em> files can’t be read due to format or permission
issues).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Always check you're in the right directory beforehand</span></span>
<span><span class="co"># getwd()</span></span>
<span></span>
<span><span class="co"># here we are downsampling the original sampling rate of 44.1 kHz to speed up downstream analyses in the vignette series</span></span>
<span><span class="fu"><a href="../reference/mp32wav.html">mp32wav</a></span><span class="op">(</span>samp.rate <span class="op">=</span> <span class="fl">22.05</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use checkwavs to see if wav files can be read</span></span>
<span><span class="fu"><a href="../reference/check_wavs.html">check_wavs</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p> </p>
</div>
</div>
<div class="section level2">
<h2 id="a-note-on-combining-data-from-different-sources">
<strong>A note on combining data from different
sources</strong><a class="anchor" aria-label="anchor" href="#a-note-on-combining-data-from-different-sources"></a>
</h2>
<p>We now have <em>.wav</em> files for existing recordings (
<em>Phae.long1.wav</em> through <em>Phae.long4.wav</em>, representing
recordings made in the field) as well as 6 recordings downloaded from
<em>xeno-canto</em>. The existing Phae.long*.wav recordings have
associated selection tables that were made in <em>Raven</em>, but the
<em>xeno-canto</em> have no selection tables, as we have not parsed
these sound files to select signals within them.</p>
<p>Depending on your question(s), you can combine your own sound files
and those from <code>xeno-canto</code> into a single data set (after
ground-truthing). This is made possible by the fact that
<code>warbleR</code> functions will read in all sound files present in
your working directory.</p>
<p>For the main case study in this vignette, we will move forwards with
only the <code>xeno-canto</code> sound files. We will use the example
sound files when demonstrating <code>warbleR</code> functions that are
not mandatory for the case study but may be useful for your own workflow
(e.g. <code>consolidate</code> below).</p>
<p>To continue the workflow, remove all example <em>wav</em> files from
your working directory</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make sure you are in the right working directory</span></span>
<span><span class="co"># Note that all the example sound files begin with the pattern "Phae.long"</span></span>
<span><span class="va">wavs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"wav$"</span><span class="op">)</span></span>
<span><span class="va">wavs</span></span>
<span></span>
<span><span class="va">rm</span> <span class="op">&lt;-</span> <span class="va">wavs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"Phae.long"</span>, <span class="va">wavs</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="va">rm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check that the right wav files were removed</span></span>
<span><span class="co"># Only xeno-cant wav files should remain</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"wav$"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="consolidate-sound-files-across-various-directories">Consolidate sound files across various directories<a class="anchor" aria-label="anchor" href="#consolidate-sound-files-across-various-directories"></a>
</h3>
<p>Since <code>warbleR</code> handles sound files in working
directories, it’s good practice to keep sound files associated with the
same project in a single directory. If you’re someone who likes to make
a new directory for every batch of recordings or new analysis associated
with the same project, you may find the <code>consolidate</code>
function useful.</p>
<p>In case you have your own recordings in <em>wav</em> format and have
skipped previous sections, you must specify the location of the sound
files you will use prior to running downstream functions by setting your
working directory again.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For this example, set your working directory to an empty temporary directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Here we will simulate the problem of having files scattered in multiple directories</span></span>
<span></span>
<span><span class="co"># Load .wav file examples from the NatureSounds package</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Phae.long1"</span>, <span class="st">"Phae.long2"</span>, <span class="st">"Phae.long3"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create first folder inside the temporary directory and write new .wav files inside this new folder</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"folder1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tuneR/man/writeWave.html" class="external-link">writeWave</a></span><span class="op">(</span><span class="va">Phae.long1</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"folder1"</span>, <span class="st">"Phae_long1.wav"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tuneR/man/writeWave.html" class="external-link">writeWave</a></span><span class="op">(</span><span class="va">Phae.long2</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"folder1"</span>, <span class="st">"Phae_long2.wav"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create second folder inside the temporary directory and write new .wav files inside this second new folder</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"folder2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/tuneR/man/writeWave.html" class="external-link">writeWave</a></span><span class="op">(</span><span class="va">Phae.long3</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"folder2"</span>, <span class="st">"Phae_long3.wav"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Consolidate the scattered files into a single folder, and make a .csv file that contains metadata (location, old and new names in the case that files were renamed)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/consolidate.html">consolidate</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, save.csv <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"./consolidated_folder"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set your working directory back to "/home/user/warbleR_example" for the rest of the vignette, or to whatever working directory you were using originally</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="make-long-spectrograms-of-whole-recordings">
<strong>Make long spectrograms of whole recordings</strong><a class="anchor" aria-label="anchor" href="#make-long-spectrograms-of-whole-recordings"></a>
</h2>
<p><code>full_spectrograms</code> produces image files with spectrograms
of whole sound files split into multiple rows. It is a useful tool for
filtering by visual inspection.</p>
<p><code>full_spectrograms</code> allows you to visually inspect the
quality of the recording (e.g. amount of background noise) or the type,
number, and completeness of the vocalizations of interest. You can
discard the image files and recordings that you no longer want to
analyze.</p>
<p>First, adjust the function arguments as needed. We can work on a
subset of the recordings by specifying their names with the
<code>flist</code> argument.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a vector of all the recordings in the directory</span></span>
<span><span class="va">wavs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"wav$"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print this object to see all sound files</span></span>
<span><span class="co"># 6 sound files from xeno-canto</span></span>
<span><span class="va">wavs</span></span>
<span></span>
<span><span class="co"># Select a subset of recordings to explore full_spectrograms() arguments</span></span>
<span><span class="co"># Based on the list of wav files we created above</span></span>
<span><span class="va">sub</span> <span class="op">&lt;-</span> <span class="va">wavs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># How long are these files? this will determine number of pages returned by full_spectrograms</span></span>
<span><span class="fu"><a href="../reference/duration_wavs.html">duration_wavs</a></span><span class="op">(</span><span class="va">sub</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ovlp = 10 to speed up function</span></span>
<span><span class="co"># tiff image files are better quality and are faster to produce</span></span>
<span><span class="fu"><a href="../reference/full_spectrograms.html">full_spectrograms</a></span><span class="op">(</span>flist <span class="op">=</span> <span class="va">sub</span>, ovlp <span class="op">=</span> <span class="fl">10</span>, it <span class="op">=</span> <span class="st">"tiff"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We can zoom in on the frequency axis by changing flim,</span></span>
<span><span class="co"># the number of seconds per row, and number of rows</span></span>
<span><span class="fu"><a href="../reference/full_spectrograms.html">full_spectrograms</a></span><span class="op">(</span>flist <span class="op">=</span> <span class="va">sub</span>, flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span>, sxrow <span class="op">=</span> <span class="fl">6</span>, rows <span class="op">=</span> <span class="fl">15</span>, ovlp <span class="op">=</span> <span class="fl">10</span>, it <span class="op">=</span> <span class="st">"tiff"</span><span class="op">)</span></span></code></pre></div>
<p>Once satisfied with the argument settings we can make long
spectrograms for all the sound files.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make long spectrograms for the xeno-canto sound files</span></span>
<span><span class="fu"><a href="../reference/full_spectrograms.html">full_spectrograms</a></span><span class="op">(</span>flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span>, ovlp <span class="op">=</span> <span class="fl">10</span>, sxrow <span class="op">=</span> <span class="fl">6</span>, rows <span class="op">=</span> <span class="fl">15</span>, it <span class="op">=</span> <span class="st">"jpeg"</span>, flist <span class="op">=</span> <span class="va">fl</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Concatenate full_spectrograms image files into a single PDF per recording</span></span>
<span><span class="co"># full_spectrograms images must be jpegs to do this</span></span>
<span><span class="fu">full_spectrograms2pdf</span><span class="op">(</span>keep.img <span class="op">=</span> <span class="cn">FALSE</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The pdf image files (in the working directory) for the
<em>xeno-canto</em> recordings should look like this:</p>
<!-- <center> ![full_spectrograms image example](Phaethornis-longirostris-154072-p1.jpg)</center>  -->
<p> </p>
<p>The sound file name and page number are placed in the top right
corner. The dimensions of the image are made to letter paper size for
printing and subsequent visual inspection.</p>
<p>Recording <em>154123</em> has a lot of background noise. Delete the
<em>wav</em> file for this recording to remove it from subsequent
analyses.</p>
</div>
<div class="section level2">
<h2 id="select-signals-in-warbler">
<strong>Select signals in <em>warbleR</em></strong><a class="anchor" aria-label="anchor" href="#select-signals-in-warbler"></a>
</h2>
<p><em>warbleR</em> provides a function for selecting acoustic signals
within recordings. <code>auto_detec</code> automatically detects the
start and end of signals in sound files based on amplitude, duration,
and frequency range attributes.</p>
<p>Both functions are fastest with shorter recordings, but there are
ways to deal with larger recordings (an hour long or more). In this
section we have expanded on some important function arguments, but check
out the function documentation for more information.</p>
<div class="section level3">
<h3 id="automatically-detect-signals-with-auto_detec">Automatically detect signals with <code>auto_detec</code><a class="anchor" aria-label="anchor" href="#automatically-detect-signals-with-auto_detec"></a>
</h3>
<p><code>auto_detec</code> has 2 types of output:** + data frame with
recording name, selection, start and end times. The last two are
temporal coordinates that will be passed on to downstream functions to
measure acoustic parameters + a spectrogram per recording, with red
dotted lines marking the start and end of each detected signal, saved in
your working directory</p>
<p>Check out the <code>auto_detec</code> documentation for more
information. The argument <code>threshold</code> is one of the most
important detection parameters, as well as information about signal
frequency range and duration. <em>Phaethornis longirostris</em> songs
have frequencies between 2 and 10 kHz and durations between 0.05 and 0.5
s.</p>
<p>If you need to detect all or most of the signals within the
recording, play around with different arguments to increase detection
accuracy. Since you may need to do several rounds of optimization, we
recommend using subsets of your recordings to speed up the process. If
the species you study produces stereotyped signals, like <em>Phaethornis
longirostris</em>, just a few signals are needed per recording, and a
low-accuracy detection could yield enough selections.</p>
<p><code>auto_detec</code> does not replace visual inspection of
selected signals. Ensure that you set aside the time to inspect all
selected signals for accuracy. You will often need to run detection
functions several times, and in the process you will get to know your
signals better (if you don’t already).</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Select a subset of sound files</span></span>
<span><span class="co"># Reinitialize the wav object</span></span>
<span><span class="va">wavs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">".wav$"</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set a seed so we all have the same results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sub</span> <span class="op">&lt;-</span> <span class="va">wavs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">wavs</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Run auto_detec() on subset of recordings</span></span>
<span><span class="co"># The data frame object output is printed to the console, we are not saving this in an object yet, since we are just playing around with argument settings</span></span>
<span><span class="co"># you can run this in parallel to speed up computation time</span></span>
<span><span class="fu"><a href="../reference/auto_detec.html">auto_detec</a></span><span class="op">(</span>flist <span class="op">=</span> <span class="va">sub</span>, bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, threshold <span class="op">=</span> <span class="fl">10</span>, mindur <span class="op">=</span> <span class="fl">0.05</span>, maxdur <span class="op">=</span> <span class="fl">0.5</span>, envt <span class="op">=</span> <span class="st">"abs"</span>, ssmooth <span class="op">=</span> <span class="fl">300</span>, ls <span class="op">=</span> <span class="cn">TRUE</span>, res <span class="op">=</span> <span class="fl">100</span>, flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span><span class="op">)</span>, wl <span class="op">=</span> <span class="fl">300</span>, set <span class="op">=</span> <span class="cn">TRUE</span>, sxrow <span class="op">=</span> <span class="fl">6</span>, rows <span class="op">=</span> <span class="fl">15</span>, redo <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Check out the image files in your working directory. Note that some
songs were correctly detected but other undesired sounds were also
detected. In most cases, the undesired selections have a shorter
duration than our target signals.</p>
<p>We won’t save the <code>auto_detec</code> ouput in an object until
we’re satisfied with the detection. To improve our detection we should
play around with argument values. Also note that the image files
produced by <code>auto_detec</code> contain the values used for the
different arguments, which can help you better compare between runs.
Below are some detection parameters that work well for these
<em>Phaethornis longirostris </em> recordings:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/auto_detec.html">auto_detec</a></span><span class="op">(</span>flist <span class="op">=</span> <span class="va">sub</span>, bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span>, threshold <span class="op">=</span> <span class="fl">20</span>, mindur <span class="op">=</span> <span class="fl">0.09</span>, maxdur <span class="op">=</span> <span class="fl">0.22</span>, envt <span class="op">=</span> <span class="st">"abs"</span>, ssmooth <span class="op">=</span> <span class="fl">900</span>, ls <span class="op">=</span> <span class="cn">TRUE</span>, res <span class="op">=</span> <span class="fl">100</span>, flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">12</span><span class="op">)</span>, wl <span class="op">=</span> <span class="fl">300</span>, set <span class="op">=</span> <span class="cn">TRUE</span>, sxrow <span class="op">=</span> <span class="fl">6</span>, rows <span class="op">=</span> <span class="fl">15</span>, redo <span class="op">=</span> <span class="cn">TRUE</span>, it <span class="op">=</span> <span class="st">"tiff"</span>, img <span class="op">=</span> <span class="cn">TRUE</span>, smadj <span class="op">=</span> <span class="st">"end"</span><span class="op">)</span></span></code></pre></div>
<p>This seems to provide a good detection for most recordings (recording
ID 154161):</p>
<center>
<div class="figure">
<img src="154161-autodetec.th15.jpg" alt=""><p class="caption">auto_detec image example</p>
</div>
</center>
<p> </p>
<p>Once we’re satisfied with the detection, we can run the
<code>auto_detec</code> on all the recordings, removing the argument
<code>flist</code> (so <code>auto_detec</code> runs over all
<em>wav</em> files in the working directory). We will also save the
temporal output in an object.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Phae.ad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/auto_detec.html">auto_detec</a></span><span class="op">(</span>bp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span>, threshold <span class="op">=</span> <span class="fl">20</span>, mindur <span class="op">=</span> <span class="fl">0.09</span>, maxdur <span class="op">=</span> <span class="fl">0.22</span>, envt <span class="op">=</span> <span class="st">"abs"</span>, ssmooth <span class="op">=</span> <span class="fl">900</span>, ls <span class="op">=</span> <span class="cn">TRUE</span>, res <span class="op">=</span> <span class="fl">100</span>, flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span>, wl <span class="op">=</span> <span class="fl">300</span>, set <span class="op">=</span> <span class="cn">TRUE</span>, sxrow <span class="op">=</span> <span class="fl">6</span>, rows <span class="op">=</span> <span class="fl">15</span>, redo <span class="op">=</span> <span class="cn">TRUE</span>, it <span class="op">=</span> <span class="st">"tiff"</span>, img <span class="op">=</span> <span class="cn">TRUE</span>, smadj <span class="op">=</span> <span class="st">"end"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s look at the number of selections per sound file:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Phae.ad</span><span class="op">$</span><span class="va">sound.files</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="use-snr-to-filter-automatically-selected-signals">Use SNR to filter automatically selected signals<a class="anchor" aria-label="anchor" href="#use-snr-to-filter-automatically-selected-signals"></a>
</h3>
<p>Signal-to-noise ratio (SNR) can be a useful filter for automated
signal detection. When background noise is detected as a signal it will
have a low SNR, and this characteristic can be used to remove background
noise from the <code>auto_detec</code> selection table. SNR = 1 means
the signal and background noise have the same amplitude, so signals with
SNR &lt;= 1 are poor quality. SNR calculations can also be used for
different purposes throughout your analysis workflow.</p>
<div class="section level4">
<h4 id="optimize-snr-measurements">Optimize SNR measurements<a class="anchor" aria-label="anchor" href="#optimize-snr-measurements"></a>
</h4>
<p><code>snr_spectrograms</code> is a function in the family of
spectrogram creators that allows you to pick a margin for measuring
noise. These margins are very important for calculating SNR, especially
when working with signals separated by short gaps (e.g. duets).</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A margin that's too large causes other signals to be included in the noise measurement</span></span>
<span><span class="co"># Re-initialize X as needed, for either auto_detec output</span></span>
<span></span>
<span><span class="co"># Try this with 10% of the selections first</span></span>
<span><span class="co"># Set a seed first, so we all have the same results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">Phae.ad</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Phae.ad</span><span class="op">)</span>, <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Phae.ad</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/snr_spectrograms.html">snr_spectrograms</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span>, snrmar <span class="op">=</span> <span class="fl">0.5</span>, mar <span class="op">=</span> <span class="fl">0.7</span>, it <span class="op">=</span> <span class="st">"jpeg"</span><span class="op">)</span></span></code></pre></div>
<p>Check out the image files in your working directory. This margin
overlaps neighboring signals, so a smaller margin would be better.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This smaller margin is better</span></span>
<span><span class="fu"><a href="../reference/snr_spectrograms.html">snr_spectrograms</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, flim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span>, snrmar <span class="op">=</span> <span class="fl">0.04</span>, mar <span class="op">=</span> <span class="fl">0.7</span>, it <span class="op">=</span> <span class="st">"jpeg"</span><span class="op">)</span></span></code></pre></div>
<!-- <center> ![snrpecs image example](Phaethornis-longirostris-154161.wav-113-snr2.jpeg) </center> -->
<p> </p>
</div>
<div class="section level4">
<h4 id="calculate-snr-for-automatically-selected-signals">Calculate SNR for automatically selected signals<a class="anchor" aria-label="anchor" href="#calculate-snr-for-automatically-selected-signals"></a>
</h4>
<p>Once we’ve picked an SNR margin we can move forward with the SNR
calculation. We will measure SNR on every other selection to speed up
the process.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Phae.snr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sig2noise.html">sig2noise</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">Phae.ad</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Phae.ad</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="op">]</span>, mar <span class="op">=</span> <span class="fl">0.04</span><span class="op">)</span></span></code></pre></div>
<p>As we just need a few songs to characterize individuals (here sound
files are equivalent to different individuals), we can choose selections
with the highest SNR per sound file. In this example, we will choose 5
selections per recording with the highest SNRs.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Phae.hisnr</span> <span class="op">&lt;-</span> <span class="va">Phae.snr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/ave.html" class="external-link">ave</a></span><span class="op">(</span><span class="op">-</span><span class="va">Phae.snr</span><span class="op">$</span><span class="va">SNR</span>, <span class="va">Phae.snr</span><span class="op">$</span><span class="va">sound.files</span>, FUN <span class="op">=</span> <span class="va">rank</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">5</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># save the selections as a physical file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">Phae.hisnr</span>, <span class="st">"Phae_hisnr.csv"</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Double check the number of selection per sound files</span></span>
<span><span class="co"># Only the xeno-canto sound files will have 5 selections, the other sound files started off with less than 5 selections</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">Phae.hisnr</span><span class="op">$</span><span class="va">sound.files</span><span class="op">)</span></span></code></pre></div>
<p> </p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="next-vignette-visual-inspection-and-signal-classification">
<strong>Next vignette: Visual inspection and signal
classification</strong><a class="anchor" aria-label="anchor" href="#next-vignette-visual-inspection-and-signal-classification"></a>
</h2>
<p>Here we have given examples of how to begin the <code>warbleR</code>
workflow. Note that there are many different ways to begin the workflow,
depending on your question and source of data. After running the code in
this first vignette, you should now have an idea of:</p>
<ul>
<li>the type of data used in <em>warbleR</em> (sound files and
selections)</li>
<li>how to import <em>Raven</em> selection tables for your own sound
files</li>
<li>how to obtain open-access <em>xeno-canto</em> sound files</li>
<li>how to create long spectrograms of recordings for visual
inspection</li>
<li>how to select signals within sound files in <code>warbleR</code>
<ul>
<li>automatic selection</li>
<li>filtering automatically selected signals using SNR</li>
<li>manual selection</li>
</ul>
</li>
</ul>
<p>The next vignette will cover the second phase of the <em>warbleR</em>
workflow, which includes methods to visualize signals for quality
control and classification.</p>
</div>
<div class="section level2">
<h2 id="citation">
<strong>Citation</strong><a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>Please cite <code>warbleR</code> when you use the package:</p>
<p>Araya-Salas, M. and Smith-Vidaurre, G. (2017), warbleR: an R package
to streamline analysis of animal acoustic signals. Methods Ecol Evol. 8,
184-191.</p>
</div>
<div class="section level2">
<h2 id="reporting-bugs">
<strong>Reporting bugs</strong><a class="anchor" aria-label="anchor" href="#reporting-bugs"></a>
</h2>
<p>Please report any bugs <a href="https://github.com/maRce10/warbleR/issues" class="external-link">here</a>.  </p>
</div>
<div class="section level2">
<h2 id="references">
<font size="5"><a name="References">References</a></font><a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Araya-Salas, M. and G. Smith-Vidaurre. 2016. warbleR: an R
package to streamline analysis of animal acoustic signals. <em>Methods
in Ecology and Evolution</em>. doi: 10.1111/2041-210X.12624</p></li>
<li><p>Araya-Salas, M. and T. Wright. 2013. Open-ended song learning in
a hummingbird. <em>Biology Letters</em>. 9 (5). doi:
10.1098/rsbl.2013.0625</p></li>
<li><p>Medina-Garcia, Angela, M. Araya-Salas, and T. Wright. 2015. Does
vocal learning accelerate acoustic diversification? Evolution of contact
calls in Neotropical parrots. <em>Journal of Evolutionary Biology</em>.
doi: 10.1111/jeb.12694</p></li>
</ol>
<p> </p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marcelo Araya-Salas, Grace Smith-Vidaurre.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  
</body>
</html>
